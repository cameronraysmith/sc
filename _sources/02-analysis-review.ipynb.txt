{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "59520860-b69b-4e5d-a049-2325c3e70e5b",
   "metadata": {
    "slideshow": {
     "slide_type": "slide"
    },
    "tags": []
   },
   "source": [
    "# Analysis review"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d6950c1b-5cbb-4be5-83c4-9029d7f3d969",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "## Overview"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a1591584-6e8d-4d2f-aef6-4a7269e352aa",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "This notebook follows the tutorial by [mousepixels/sanbomics](https://github.com/mousepixels/sanbomics/blob/main/single_cell_analysis_complete_class.ipynb), which has an accompanying [screencast](https://youtu.be/uvyG9yLuNSE?t=319).\n",
    "\n",
    "Analysis is illustrated with single-nucleus RNA sequencing data from the following paper <cite data-cite=\"Melms2021-bj\">Melms et al. (2021)</cite>\n",
    "\n",
    "> Melms JC, Biermann J, Huang H, Wang Y, Nair A, Tagore S, et al.\n",
    "A molecular single-cell lung atlas of lethal COVID-19.\n",
    "Nature. 2021;595: 114–119. [doi:10.1038/s41586-021-03569-0](https://doi.org/10.1038/s41586-021-03569-0)\n",
    "\n",
    "This paper examined 116,000 nuclei from the lungs of nineteen patients who underwent autopsy following death in association with COVID-19. Findings reported in the abstract of the paper include:\n",
    "\n",
    "1. activated monocyte-derived macrophages and alveolar macrophages\n",
    "1. impaired T cell activation\n",
    "1. monocyte/macrophage-derived interleukin-1β and epithelial cell-derived interleukin-6\n",
    "1. alveolar type 2 cells adopted an inflammation-associated transient progenitor cell state and failed to undergo full transition into alveolar type 1 cells\n",
    "1. expansion of CTHRC1+ pathological fibroblasts\n",
    "1. protein activity and ligand–receptor interactions suggest putative drug targets\n",
    "\n",
    "This notebook makes extensive use of <cite data-cite=\"Wolf2018-nu\">Wolf et al. (2018)</cite> and <cite data-cite=\"Lopez2018-em\">Lopez et al. (2018)</cite> including updates that have been made to the underlying software packages, [scanpy](https://github.com/scverse/scanpy) and [scvi-tools](https://github.com/scverse/scvi-tools), since their initial publication."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1bf91286-2ec3-45a5-960f-349c7ab00e92",
   "metadata": {
    "incorrectly_encoded_metadata": "tags=[] slideshow={\"slide_type\": \"slide\"} jp-MarkdownHeadingCollapsed=true",
    "slideshow": {
     "slide_type": "slide"
    },
    "tags": []
   },
   "source": [
    "## Setup"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "37d85862-f21b-486e-abb7-6331cb0c8431",
   "metadata": {
    "incorrectly_encoded_metadata": "tags=[] slideshow={\"slide_type\": \"subslide\"} jp-MarkdownHeadingCollapsed=true",
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "### Import libraries"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "f9a8d232-554e-4456-a18f-2c2093c3d552",
   "metadata": {
    "collapsed": true,
    "execution": {
     "iopub.execute_input": "2022-09-29T00:49:44.405725Z",
     "iopub.status.busy": "2022-09-29T00:49:44.405358Z",
     "iopub.status.idle": "2022-09-29T00:50:19.115768Z",
     "shell.execute_reply": "2022-09-29T00:50:19.114889Z",
     "shell.execute_reply.started": "2022-09-29T00:49:44.405656Z"
    },
    "jupyter": {
     "outputs_hidden": true
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "Global seed set to 0\n",
      "/usr/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:53: LightningDeprecationWarning: pytorch_lightning.utilities.warnings.rank_zero_deprecation has been deprecated in v1.6 and will be removed in v1.8. Use the equivalent function from the pytorch_lightning.utilities.rank_zero module instead.\n",
      "  new_rank_zero_deprecation(\n",
      "/usr/lib/python3.10/site-packages/pytorch_lightning/utilities/warnings.py:58: LightningDeprecationWarning: The `pytorch_lightning.loggers.base.rank_zero_experiment` is deprecated in v1.7 and will be removed in v1.9. Please use `pytorch_lightning.loggers.logger.rank_zero_experiment` instead.\n",
      "  return new_rank_zero_deprecation(*args, **kwargs)\n"
     ]
    }
   ],
   "source": [
    "from inspect import getmembers\n",
    "from pprint import pprint\n",
    "from types import FunctionType\n",
    "\n",
    "import pickle\n",
    "import scanpy as sc\n",
    "import scvi\n",
    "import seaborn as sns"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c7f0e5b1-c6bf-4339-8b24-dbcc5f20ade4",
   "metadata": {
    "incorrectly_encoded_metadata": "tags=[] slideshow={\"slide_type\": \"subslide\"} jp-MarkdownHeadingCollapsed=true",
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "### Setup plotting"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "7753e0a8-2531-4072-bada-0ed4f1ce2424",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-29T00:50:19.117842Z",
     "iopub.status.busy": "2022-09-29T00:50:19.117383Z",
     "iopub.status.idle": "2022-09-29T00:50:19.121629Z",
     "shell.execute_reply": "2022-09-29T00:50:19.120793Z",
     "shell.execute_reply.started": "2022-09-29T00:50:19.117818Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import matplotlib.font_manager\n",
    "import matplotlib.pyplot as plt\n",
    "\n",
    "# import matplotlib_inline"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "0a66d0c4-f945-4292-af42-41a4c882c69d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-29T00:50:19.122718Z",
     "iopub.status.busy": "2022-09-29T00:50:19.122515Z",
     "iopub.status.idle": "2022-09-29T00:50:19.259508Z",
     "shell.execute_reply": "2022-09-29T00:50:19.258984Z",
     "shell.execute_reply.started": "2022-09-29T00:50:19.122700Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# fonts_path = \"/usr/share/texmf/fonts/opentype/public/lm/\" #ubuntu\n",
    "# fonts_path = \"~/Library/Fonts/\" # macos\n",
    "fonts_path = \"/usr/share/fonts/OTF/\"  # arch\n",
    "# user_path = \"$HOME/\" # user\n",
    "# fonts_path = user_path + \"fonts/latinmodern/opentype/public/lm/\"  # home\n",
    "matplotlib.font_manager.fontManager.addfont(fonts_path + \"lmsans10-regular.otf\")\n",
    "matplotlib.font_manager.fontManager.addfont(fonts_path + \"lmroman10-regular.otf\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "19089090-2e39-48b9-8347-aaa8c7d73365",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-29T00:50:19.261678Z",
     "iopub.status.busy": "2022-09-29T00:50:19.261369Z",
     "iopub.status.idle": "2022-09-29T00:50:19.270950Z",
     "shell.execute_reply": "2022-09-29T00:50:19.270168Z",
     "shell.execute_reply.started": "2022-09-29T00:50:19.261650Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# https://stackoverflow.com/a/36622238/446907\n",
    "%config InlineBackend.figure_formats = ['svg']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "e2ee4e70-7272-4ae2-9f15-c9d9401175de",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-29T00:50:19.272082Z",
     "iopub.status.busy": "2022-09-29T00:50:19.271852Z",
     "iopub.status.idle": "2022-09-29T00:50:19.277676Z",
     "shell.execute_reply": "2022-09-29T00:50:19.276849Z",
     "shell.execute_reply.started": "2022-09-29T00:50:19.272034Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "plt.style.use(\"default\")  # reset default parameters\n",
    "# https://stackoverflow.com/a/3900167/446907\n",
    "plt.rcParams.update(\n",
    "    {\n",
    "        \"font.size\": 16,\n",
    "        \"font.family\": [\"sans-serif\"],\n",
    "        \"font.serif\": [\"Latin Modern Roman\"] + plt.rcParams[\"font.serif\"],\n",
    "        \"font.sans-serif\": [\"Latin Modern Sans\"] + plt.rcParams[\"font.sans-serif\"],\n",
    "    }\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b276e8e9-465a-48b9-abb1-804023ad0452",
   "metadata": {
    "incorrectly_encoded_metadata": "tags=[] slideshow={\"slide_type\": \"subslide\"} jp-MarkdownHeadingCollapsed=true",
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "### Utility functions"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "b00d10ed-2dca-4162-8b96-6b7a4e6d2495",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-29T00:50:19.279083Z",
     "iopub.status.busy": "2022-09-29T00:50:19.278813Z",
     "iopub.status.idle": "2022-09-29T00:50:19.284091Z",
     "shell.execute_reply": "2022-09-29T00:50:19.283289Z",
     "shell.execute_reply.started": "2022-09-29T00:50:19.279054Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "def attributes(obj):\n",
    "    \"\"\"\n",
    "    get object attributes\n",
    "    \"\"\"\n",
    "    disallowed_names = {\n",
    "        name for name, value in getmembers(type(obj)) if isinstance(value, FunctionType)\n",
    "    }\n",
    "    return {\n",
    "        name: getattr(obj, name)\n",
    "        for name in dir(obj)\n",
    "        if name[0] != \"_\" and name not in disallowed_names and hasattr(obj, name)\n",
    "    }\n",
    "\n",
    "\n",
    "def print_attributes(obj):\n",
    "    \"\"\"\n",
    "    print object attributes\n",
    "    \"\"\"\n",
    "    pprint(attributes(obj))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9d4bcb6b-b476-4fec-b38d-bfa91470d91a",
   "metadata": {
    "slideshow": {
     "slide_type": "slide"
    },
    "tags": []
   },
   "source": [
    "## Import data"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7237d5b8-2eed-43b6-a99d-850def235b55",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "Here we review how the data were downloaded, and proceed to import and inspect the data."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ef4bb28d-cb0c-404a-a23b-add821f95335",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "### Data download"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "765825f9-3a14-4eba-9643-5cebe5f0ad62",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "Data with GEO accession [GSE171524](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE171524) was downloaded using [./data/download_geo_data.sh](./data/download_geo_data.sh) with parameters\n",
    "\n",
    "```bash\n",
    "./download_geo_data.sh \\\n",
    "       -a GSE132771 \\\n",
    "       -f 'ftp.*RAW.*' \\\n",
    "       -j '..|.supplementary_files?|..|.url?|select(length>0)'\n",
    "```\n",
    "\n",
    "A skeleton of this script that may work in this case is\n",
    "\n",
    "```bash\n",
    "!/usr/bin/env bash\n",
    "\n",
    "#-- debugging (comment to reduce stderr output)\n",
    "#-- https://wiki.bash-hackers.org/scripting/debuggingtips\n",
    "export PS4='+(${BASH_SOURCE}:${LINENO}): ${FUNCNAME[0]:+${FUNCNAME[0]}(): }'\n",
    "set -o xtrace\n",
    "\n",
    "# get metadata\n",
    "# Melms JC, Biermann J, Huang H, Wang Y, Nair A, Tagore S, et al.\n",
    "# A molecular single-cell lung atlas of lethal COVID-19.\n",
    "# Nature. 2021;595: 114–119. doi:10.1038/s41586-021-03569-0\n",
    "# GSE171524\n",
    "ffq -l 1 -o GSE171524.json GSE171524\n",
    "\n",
    "# download raw data\n",
    "wget ftp://ftp.ncbi.nlm.nih.gov/geo/series/GSE171nnn/GSE171524/suppl/GSE171524_RAW.tar\n",
    "\n",
    "# list contents\n",
    "tar -tvf GSE171524_RAW.tar\n",
    "\n",
    "# untar\n",
    "mkdir -p GSE171524 && \\\n",
    "tar -xvf GSE171524_RAW.tar -C GSE171524\n",
    "```"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f397a2cd-f736-4ad8-9c67-9489fb4175e4",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "### Data load"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3da09157-598a-49e4-91fc-c553c39f919d",
   "metadata": {},
   "source": [
    "See the [documentation for scanpy read csv](https://scanpy.readthedocs.io/en/latest/generated/scanpy.read_csv.html) which returns an [AnnData object](https://anndata.readthedocs.io/en/stable/generated/anndata.AnnData.html#anndata.AnnData)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "af6bd525-b037-46a1-bced-ec5c95fc27b6",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:33:42.947627Z",
     "iopub.status.busy": "2022-09-28T19:33:42.947272Z",
     "iopub.status.idle": "2022-09-28T19:34:11.107603Z",
     "shell.execute_reply": "2022-09-28T19:34:11.106619Z",
     "shell.execute_reply.started": "2022-09-28T19:33:42.947597Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "AnnData object with n_obs × n_vars = 6099 × 34546"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata = None\n",
    "adata = sc.read_csv(\n",
    "    \"data/GSE171524/supplementary/GSM5226574_C51ctr_raw_counts.csv.gz\"\n",
    ").T\n",
    "adata"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1fc1706e-ed40-4e3f-aac1-9177f7bc3d8c",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "Note the `scanpy.read_csv` function accepts gzipped files."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2c91ab10-ff83-46f4-84b1-98434d7a7331",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "### Data properties"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "681493e8-c15c-479a-bab8-b2f0e4a83c63",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:11.109321Z",
     "iopub.status.busy": "2022-09-28T19:34:11.109073Z",
     "iopub.status.idle": "2022-09-28T19:34:11.114528Z",
     "shell.execute_reply": "2022-09-28T19:34:11.113832Z",
     "shell.execute_reply.started": "2022-09-28T19:34:11.109300Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "anndata._core.anndata.AnnData"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "type(adata)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "9c229ea8-dc2f-4a62-969f-e0a5ee230b04",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:11.116046Z",
     "iopub.status.busy": "2022-09-28T19:34:11.115775Z",
     "iopub.status.idle": "2022-09-28T19:34:11.139220Z",
     "shell.execute_reply": "2022-09-28T19:34:11.137756Z",
     "shell.execute_reply.started": "2022-09-28T19:34:11.116025Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(6099, 34546)"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.X.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "27b0621a-22d8-411d-a5fb-527c580280b2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:11.140511Z",
     "iopub.status.busy": "2022-09-28T19:34:11.140273Z",
     "iopub.status.idle": "2022-09-28T19:34:11.182908Z",
     "shell.execute_reply": "2022-09-28T19:34:11.181929Z",
     "shell.execute_reply.started": "2022-09-28T19:34:11.140492Z"
    },
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "{'T': AnnData object with n_obs × n_vars = 34546 × 6099,\n",
      " 'X': array([[0., 0., 0., ..., 0., 0., 0.],\n",
      "       [0., 0., 0., ..., 0., 0., 0.],\n",
      "       [0., 0., 0., ..., 0., 0., 0.],\n",
      "       ...,\n",
      "       [0., 0., 0., ..., 0., 0., 0.],\n",
      "       [0., 0., 0., ..., 0., 0., 0.],\n",
      "       [0., 0., 0., ..., 0., 0., 0.]], dtype=float32),\n",
      " 'file': Backing file manager: no file is set.,\n",
      " 'filename': None,\n",
      " 'is_view': False,\n",
      " 'isbacked': False,\n",
      " 'isview': False,\n",
      " 'layers': Layers with keys: ,\n",
      " 'n_obs': 6099,\n",
      " 'n_vars': 34546,\n",
      " 'obs': Empty DataFrame\n",
      "Columns: []\n",
      "Index: [TAGGTACCATGGCCAC-1_1, ATTCACTGTAACAGGC-1_1, TAACTTCCAACCACGC-1_1, TTGGGTACACGACAAG-1_1, AGGCCACAGAGTCACG-1_1, CACTGAAGTCGAAGCA-1_1, ACTGATGTCTGCACCT-1_1, TTACCGCCACTCAGAT-1_1, TTGGTTTTCCTAGCTC-1_1, TGGGAAGTCAGTGATC-1_1, CCACGAGTCTCTTAAC-1_1, ACTTCCGCACAACGCC-1_1, GGGAAGTAGCGACCCT-1_1, TGGTAGTTCCCGTGTT-1_1, CGCATAACATGCCGGT-1_1, TCTATCACAAGGCTTT-1_1, ATCCACCAGAGGTATT-1_1, TAACGACAGATGACCG-1_1, TCTTAGTGTATGAGGC-1_1, CACTTCGCAGTACTAC-1_1, GTCAAACAGAACGTGC-1_1, GCAACCGAGGGCAGGA-1_1, CATACTTTCATCACTT-1_1, AAGAACATCGGATTAC-1_1, GGGTATTGTACGATGG-1_1, CTGTAGATCAACGTGT-1_1, GTCATTTGTATCTCGA-1_1, CCTTGTGCAGAGGGTT-1_1, AAGTTCGCAACACGTT-1_1, TCATTCACAAATCAAG-1_1, TCCATGCCAACGACTT-1_1, TCCTTCTCAGTTTCAG-1_1, TGTGAGTCAAATGATG-1_1, AAACGAAGTACAGAGC-1_1, CAACCAAAGTATTCCG-1_1, CTTCTCTCAGAGACTG-1_1, TACAACGGTGGCTGAA-1_1, AACGGGACATGCCGGT-1_1, AACCAACGTTGGGAAC-1_1, TATATCCAGCGTCAGA-1_1, AGACAAACATCCCGTT-1_1, ATGACCAGTCTTCATT-1_1, CTTACCGTCAGACATC-1_1, CGGGACTGTTAGTTCG-1_1, ATTCATCCACTGAGTT-1_1, TCATGAGAGAGGCGGA-1_1, TCCCACATCTAGTACG-1_1, CTTCCTTCATATCTCT-1_1, CCGGACACACTCGATA-1_1, ACACGCGCACCTGTCT-1_1, GAATCGTCAGAAGTGC-1_1, GGTGGCTCAAGCTCTA-1_1, CCTGCATCACATATGC-1_1, GTGGGAAGTTAAAGTG-1_1, CGTTCTGGTACTAGCT-1_1, ACCCTCACAATAGTCC-1_1, GCCCGAACAAACTAAG-1_1, GTGGAAGCACATGACT-1_1, GTTGTGACATCGATAC-1_1, GACAGCCCAGGTCCGT-1_1, TAAGCACGTTGGCTAT-1_1, GGGACAAGTCACCACG-1_1, CTGGCAGGTTCGGTAT-1_1, GACTCAACACTGTGAT-1_1, GCCAGTGGTGTGGTCC-1_1, TCTAACTGTAGGCAGT-1_1, GAAGAATGTAGCTTGT-1_1, TCACTCGCAATCTCTT-1_1, CAAGACTTCCCACAGG-1_1, CAGATACGTGACTCTA-1_1, TGGGATTAGAGGGTCT-1_1, ACCTGAACACTCCTTG-1_1, GACACGCCACTCGATA-1_1, CTCATCGTCACCGCTT-1_1, AGGTAGGGTCCCTGTT-1_1, TACCCGTCAACACTAC-1_1, TGCTGAAAGACGGATC-1_1, ACACCAACACAACGCC-1_1, AAGATAGCAAATGGAT-1_1, CTTCAATGTGACAGGT-1_1, GAAGCGAAGAGTTGAT-1_1, GCCGTGACACAAGCCC-1_1, CCTCAACCATACAGGG-1_1, ACAAAGATCCACAGGC-1_1, CAGATACAGTCCCAGC-1_1, GGCAGTCTCCGGTTCT-1_1, TAAGTCGAGCTGAGCA-1_1, GAGACCCGTCTGTGCG-1_1, TAACACGCATGTGTCA-1_1, TCAATTCGTTCTCGCT-1_1, GCTTTCGCACAGTGTT-1_1, AACCAACAGATAACAC-1_1, ATCGGCGCACATCATG-1_1, TCATCCGCACGAGGAT-1_1, CTGATCCTCTTTACAC-1_1, TCACACCCAACTTCTT-1_1, TGAGGGACACCGTACG-1_1, GTGCACGTCATCTGTT-1_1, GGTAATCAGTTGCATC-1_1, ATACTTCCAAGGTCTT-1_1, ...]\n",
      "\n",
      "[6099 rows x 0 columns],\n",
      " 'obs_names': Index(['TAGGTACCATGGCCAC-1_1', 'ATTCACTGTAACAGGC-1_1', 'TAACTTCCAACCACGC-1_1',\n",
      "       'TTGGGTACACGACAAG-1_1', 'AGGCCACAGAGTCACG-1_1', 'CACTGAAGTCGAAGCA-1_1',\n",
      "       'ACTGATGTCTGCACCT-1_1', 'TTACCGCCACTCAGAT-1_1', 'TTGGTTTTCCTAGCTC-1_1',\n",
      "       'TGGGAAGTCAGTGATC-1_1',\n",
      "       ...\n",
      "       'AAGTCGTGTGTGAATA-1_1', 'GTCGTTCTCCAAGGGA-1_1', 'GTTTGGATCGGCCTTT-1_1',\n",
      "       'GTACAGTCACGTATAC-1_1', 'TCATGCCCAAGAGGTC-1_1', 'CGCCATTGTTTGCCGG-1_1',\n",
      "       'CACTGGGGTCTACGTA-1_1', 'CATACTTGTAGAGGAA-1_1', 'TTTGGTTTCCACGGAC-1_1',\n",
      "       'ATGCATGAGTCATGAA-1_1'],\n",
      "      dtype='object', length=6099),\n",
      " 'obsm': AxisArrays with keys: ,\n",
      " 'obsp': PairwiseArrays with keys: ,\n",
      " 'raw': None,\n",
      " 'shape': (6099, 34546),\n",
      " 'uns': OverloadedDict, wrapping:\n",
      "\tOrderedDict()\n",
      "With overloaded keys:\n",
      "\t['neighbors'].,\n",
      " 'var': Empty DataFrame\n",
      "Columns: []\n",
      "Index: [AL627309.1, AL627309.5, AL627309.4, AL669831.2, LINC01409, FAM87B, LINC01128, LINC00115, FAM41C, AL645608.6, AL645608.2, LINC02593, SAMD11, NOC2L, KLHL17, PLEKHN1, PERM1, AL645608.7, HES4, ISG15, AL645608.1, AGRN, C1orf159, AL390719.3, LINC01342, AL390719.2, TTLL10-AS1, TTLL10, TNFRSF18, TNFRSF4, SDF4, B3GALT6, C1QTNF12, UBE2J2, LINC01786, SCNN1D, ACAP3, PUSL1, INTS11, AL139287.1, CPTP, DVL1, MXRA8, AURKAIP1, CCNL2, MRPL20-AS1, MRPL20, AL391244.2, ANKRD65, AL391244.1, LINC01770, VWA1, ATAD3C, ATAD3B, ATAD3A, TMEM240, SSU72, AL645728.1, FNDC10, AL691432.4, AL691432.2, MIB2, MMP23B, CDK11B, FO704657.1, SLC35E2B, CDK11A, SLC35E2A, NADK, GNB1, AL109917.1, CALML6, TMEM52, CFAP74, GABRD, AL391845.1, PRKCZ, AL590822.2, PRKCZ-AS1, FAAP20, AL590822.1, SKI, AL590822.3, MORN1, AL589739.1, AL513477.2, RER1, PEX10, PLCH2, AL139246.4, PANK4, HES5, AL139246.5, TNFRSF14-AS1, TNFRSF14, AL139246.3, PRXL2B, MMEL1, TTC34, AC242022.2, ...]\n",
      "\n",
      "[34546 rows x 0 columns],\n",
      " 'var_names': Index(['AL627309.1', 'AL627309.5', 'AL627309.4', 'AL669831.2', 'LINC01409',\n",
      "       'FAM87B', 'LINC01128', 'LINC00115', 'FAM41C', 'AL645608.6',\n",
      "       ...\n",
      "       'AC087190.2', 'AC136428.1', 'AC019183.1', 'AC105094.1', 'AC010485.1',\n",
      "       'VN1R2', 'AL031676.1', 'SMIM34A', 'AL050402.1', 'AL445072.1'],\n",
      "      dtype='object', length=34546),\n",
      " 'varm': AxisArrays with keys: ,\n",
      " 'varp': PairwiseArrays with keys: }\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/tmp/ipykernel_223/22660072.py:11: DeprecationWarning: Use is_view instead of isview, isview will be removed in the future.\n",
      "  if name[0] != \"_\" and name not in disallowed_names and hasattr(obj, name)\n",
      "/tmp/ipykernel_223/22660072.py:9: DeprecationWarning: Use is_view instead of isview, isview will be removed in the future.\n",
      "  name: getattr(obj, name)\n"
     ]
    }
   ],
   "source": [
    "print_attributes(adata)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "dd8f7ca9-f5c8-404e-bfcb-c584882c1b31",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:11.184510Z",
     "iopub.status.busy": "2022-09-28T19:34:11.184178Z",
     "iopub.status.idle": "2022-09-28T19:34:11.216085Z",
     "shell.execute_reply": "2022-09-28T19:34:11.215140Z",
     "shell.execute_reply.started": "2022-09-28T19:34:11.184483Z"
    },
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>TAGGTACCATGGCCAC-1_1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ATTCACTGTAACAGGC-1_1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TAACTTCCAACCACGC-1_1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTGGGTACACGACAAG-1_1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AGGCCACAGAGTCACG-1_1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CGCCATTGTTTGCCGG-1_1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CACTGGGGTCTACGTA-1_1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CATACTTGTAGAGGAA-1_1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTTGGTTTCCACGGAC-1_1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ATGCATGAGTCATGAA-1_1</th>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>6099 rows × 0 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "Empty DataFrame\n",
       "Columns: []\n",
       "Index: [TAGGTACCATGGCCAC-1_1, ATTCACTGTAACAGGC-1_1, TAACTTCCAACCACGC-1_1, TTGGGTACACGACAAG-1_1, AGGCCACAGAGTCACG-1_1, CACTGAAGTCGAAGCA-1_1, ACTGATGTCTGCACCT-1_1, TTACCGCCACTCAGAT-1_1, TTGGTTTTCCTAGCTC-1_1, TGGGAAGTCAGTGATC-1_1, CCACGAGTCTCTTAAC-1_1, ACTTCCGCACAACGCC-1_1, GGGAAGTAGCGACCCT-1_1, TGGTAGTTCCCGTGTT-1_1, CGCATAACATGCCGGT-1_1, TCTATCACAAGGCTTT-1_1, ATCCACCAGAGGTATT-1_1, TAACGACAGATGACCG-1_1, TCTTAGTGTATGAGGC-1_1, CACTTCGCAGTACTAC-1_1, GTCAAACAGAACGTGC-1_1, GCAACCGAGGGCAGGA-1_1, CATACTTTCATCACTT-1_1, AAGAACATCGGATTAC-1_1, GGGTATTGTACGATGG-1_1, CTGTAGATCAACGTGT-1_1, GTCATTTGTATCTCGA-1_1, CCTTGTGCAGAGGGTT-1_1, AAGTTCGCAACACGTT-1_1, TCATTCACAAATCAAG-1_1, TCCATGCCAACGACTT-1_1, TCCTTCTCAGTTTCAG-1_1, TGTGAGTCAAATGATG-1_1, AAACGAAGTACAGAGC-1_1, CAACCAAAGTATTCCG-1_1, CTTCTCTCAGAGACTG-1_1, TACAACGGTGGCTGAA-1_1, AACGGGACATGCCGGT-1_1, AACCAACGTTGGGAAC-1_1, TATATCCAGCGTCAGA-1_1, AGACAAACATCCCGTT-1_1, ATGACCAGTCTTCATT-1_1, CTTACCGTCAGACATC-1_1, CGGGACTGTTAGTTCG-1_1, ATTCATCCACTGAGTT-1_1, TCATGAGAGAGGCGGA-1_1, TCCCACATCTAGTACG-1_1, CTTCCTTCATATCTCT-1_1, CCGGACACACTCGATA-1_1, ACACGCGCACCTGTCT-1_1, GAATCGTCAGAAGTGC-1_1, GGTGGCTCAAGCTCTA-1_1, CCTGCATCACATATGC-1_1, GTGGGAAGTTAAAGTG-1_1, CGTTCTGGTACTAGCT-1_1, ACCCTCACAATAGTCC-1_1, GCCCGAACAAACTAAG-1_1, GTGGAAGCACATGACT-1_1, GTTGTGACATCGATAC-1_1, GACAGCCCAGGTCCGT-1_1, TAAGCACGTTGGCTAT-1_1, GGGACAAGTCACCACG-1_1, CTGGCAGGTTCGGTAT-1_1, GACTCAACACTGTGAT-1_1, GCCAGTGGTGTGGTCC-1_1, TCTAACTGTAGGCAGT-1_1, GAAGAATGTAGCTTGT-1_1, TCACTCGCAATCTCTT-1_1, CAAGACTTCCCACAGG-1_1, CAGATACGTGACTCTA-1_1, TGGGATTAGAGGGTCT-1_1, ACCTGAACACTCCTTG-1_1, GACACGCCACTCGATA-1_1, CTCATCGTCACCGCTT-1_1, AGGTAGGGTCCCTGTT-1_1, TACCCGTCAACACTAC-1_1, TGCTGAAAGACGGATC-1_1, ACACCAACACAACGCC-1_1, AAGATAGCAAATGGAT-1_1, CTTCAATGTGACAGGT-1_1, GAAGCGAAGAGTTGAT-1_1, GCCGTGACACAAGCCC-1_1, CCTCAACCATACAGGG-1_1, ACAAAGATCCACAGGC-1_1, CAGATACAGTCCCAGC-1_1, GGCAGTCTCCGGTTCT-1_1, TAAGTCGAGCTGAGCA-1_1, GAGACCCGTCTGTGCG-1_1, TAACACGCATGTGTCA-1_1, TCAATTCGTTCTCGCT-1_1, GCTTTCGCACAGTGTT-1_1, AACCAACAGATAACAC-1_1, ATCGGCGCACATCATG-1_1, TCATCCGCACGAGGAT-1_1, CTGATCCTCTTTACAC-1_1, TCACACCCAACTTCTT-1_1, TGAGGGACACCGTACG-1_1, GTGCACGTCATCTGTT-1_1, GGTAATCAGTTGCATC-1_1, ATACTTCCAAGGTCTT-1_1, ...]\n",
       "\n",
       "[6099 rows x 0 columns]"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.obs"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b7ac5413-ee1a-40d4-8e3c-e7d4539714e9",
   "metadata": {},
   "source": [
    "Gene names are saved as `adata.var`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "78b1501a-068e-41a8-9a17-b173c6deb850",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:11.217326Z",
     "iopub.status.busy": "2022-09-28T19:34:11.217096Z",
     "iopub.status.idle": "2022-09-28T19:34:11.225118Z",
     "shell.execute_reply": "2022-09-28T19:34:11.224086Z",
     "shell.execute_reply.started": "2022-09-28T19:34:11.217306Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>AL627309.1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AL627309.5</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AL627309.4</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AL669831.2</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>LINC01409</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>VN1R2</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AL031676.1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>SMIM34A</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AL050402.1</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AL445072.1</th>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>34546 rows × 0 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "Empty DataFrame\n",
       "Columns: []\n",
       "Index: [AL627309.1, AL627309.5, AL627309.4, AL669831.2, LINC01409, FAM87B, LINC01128, LINC00115, FAM41C, AL645608.6, AL645608.2, LINC02593, SAMD11, NOC2L, KLHL17, PLEKHN1, PERM1, AL645608.7, HES4, ISG15, AL645608.1, AGRN, C1orf159, AL390719.3, LINC01342, AL390719.2, TTLL10-AS1, TTLL10, TNFRSF18, TNFRSF4, SDF4, B3GALT6, C1QTNF12, UBE2J2, LINC01786, SCNN1D, ACAP3, PUSL1, INTS11, AL139287.1, CPTP, DVL1, MXRA8, AURKAIP1, CCNL2, MRPL20-AS1, MRPL20, AL391244.2, ANKRD65, AL391244.1, LINC01770, VWA1, ATAD3C, ATAD3B, ATAD3A, TMEM240, SSU72, AL645728.1, FNDC10, AL691432.4, AL691432.2, MIB2, MMP23B, CDK11B, FO704657.1, SLC35E2B, CDK11A, SLC35E2A, NADK, GNB1, AL109917.1, CALML6, TMEM52, CFAP74, GABRD, AL391845.1, PRKCZ, AL590822.2, PRKCZ-AS1, FAAP20, AL590822.1, SKI, AL590822.3, MORN1, AL589739.1, AL513477.2, RER1, PEX10, PLCH2, AL139246.4, PANK4, HES5, AL139246.5, TNFRSF14-AS1, TNFRSF14, AL139246.3, PRXL2B, MMEL1, TTC34, AC242022.2, ...]\n",
       "\n",
       "[34546 rows x 0 columns]"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.var"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "697e4afe-2355-467d-9b38-511b1ca6cf52",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:11.226902Z",
     "iopub.status.busy": "2022-09-28T19:34:11.226576Z",
     "iopub.status.idle": "2022-09-28T19:34:11.231715Z",
     "shell.execute_reply": "2022-09-28T19:34:11.230913Z",
     "shell.execute_reply.started": "2022-09-28T19:34:11.226840Z"
    },
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Index(['TAGGTACCATGGCCAC-1_1', 'ATTCACTGTAACAGGC-1_1', 'TAACTTCCAACCACGC-1_1',\n",
       "       'TTGGGTACACGACAAG-1_1', 'AGGCCACAGAGTCACG-1_1', 'CACTGAAGTCGAAGCA-1_1',\n",
       "       'ACTGATGTCTGCACCT-1_1', 'TTACCGCCACTCAGAT-1_1', 'TTGGTTTTCCTAGCTC-1_1',\n",
       "       'TGGGAAGTCAGTGATC-1_1',\n",
       "       ...\n",
       "       'AAGTCGTGTGTGAATA-1_1', 'GTCGTTCTCCAAGGGA-1_1', 'GTTTGGATCGGCCTTT-1_1',\n",
       "       'GTACAGTCACGTATAC-1_1', 'TCATGCCCAAGAGGTC-1_1', 'CGCCATTGTTTGCCGG-1_1',\n",
       "       'CACTGGGGTCTACGTA-1_1', 'CATACTTGTAGAGGAA-1_1', 'TTTGGTTTCCACGGAC-1_1',\n",
       "       'ATGCATGAGTCATGAA-1_1'],\n",
       "      dtype='object', length=6099)"
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.obs_names"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "dac72415-179d-4635-9594-f651bff70149",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:11.236788Z",
     "iopub.status.busy": "2022-09-28T19:34:11.236147Z",
     "iopub.status.idle": "2022-09-28T19:34:11.242744Z",
     "shell.execute_reply": "2022-09-28T19:34:11.241928Z",
     "shell.execute_reply.started": "2022-09-28T19:34:11.236751Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Index(['AL627309.1', 'AL627309.5', 'AL627309.4', 'AL669831.2', 'LINC01409',\n",
       "       'FAM87B', 'LINC01128', 'LINC00115', 'FAM41C', 'AL645608.6',\n",
       "       ...\n",
       "       'AC087190.2', 'AC136428.1', 'AC019183.1', 'AC105094.1', 'AC010485.1',\n",
       "       'VN1R2', 'AL031676.1', 'SMIM34A', 'AL050402.1', 'AL445072.1'],\n",
       "      dtype='object', length=34546)"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.var_names"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2606cda3-2ed6-49f3-b314-d94f0bd36174",
   "metadata": {},
   "source": [
    "There are no layers in this data set."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "b60b7275-2f03-4858-9236-e231016c9cb2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:11.244179Z",
     "iopub.status.busy": "2022-09-28T19:34:11.243975Z",
     "iopub.status.idle": "2022-09-28T19:34:11.249789Z",
     "shell.execute_reply": "2022-09-28T19:34:11.248903Z",
     "shell.execute_reply.started": "2022-09-28T19:34:11.244161Z"
    },
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Layers with keys: "
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.layers"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "17aa201f-56a2-4b5f-8a0f-82a26b396fe5",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "There are no multidimensional observations or variables."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "cab4cc2e-6a74-441d-92ec-f9a32b751d34",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:11.251800Z",
     "iopub.status.busy": "2022-09-28T19:34:11.250947Z",
     "iopub.status.idle": "2022-09-28T19:34:11.256256Z",
     "shell.execute_reply": "2022-09-28T19:34:11.255324Z",
     "shell.execute_reply.started": "2022-09-28T19:34:11.251777Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "AxisArrays with keys: \n",
      "AxisArrays with keys: \n",
      "PairwiseArrays with keys: \n",
      "PairwiseArrays with keys: \n"
     ]
    }
   ],
   "source": [
    "print(adata.obsm)\n",
    "print(adata.varm)\n",
    "print(adata.obsp)\n",
    "print(adata.varp)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "345e74f3-1928-47a8-ae7d-6832a9560d78",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "The data appears to contain reads mapped to 6099 cell-associated barcodes and 34546 RNA molecule-associated features."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "1fa88e29-8da2-44c6-ab58-224516901a47",
   "metadata": {
    "slideshow": {
     "slide_type": "slide"
    },
    "tags": []
   },
   "source": [
    "## Doublet removal"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f480e956-8a3b-4998-ae44-53188bad6c46",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "### Filter transcripts by minimum number of cells with non-zero counts"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "cf87425e-4b04-4c7b-b881-21846ab209d3",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "We may choose to filter out transcript types that are detected in a relatively small number of cells. The optimum threshold is not known. Here we use 10 as a base case."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "65c13617-0e22-40e2-9372-b02a35667264",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:33.684837Z",
     "iopub.status.busy": "2022-09-28T19:34:33.684334Z",
     "iopub.status.idle": "2022-09-28T19:34:33.690155Z",
     "shell.execute_reply": "2022-09-28T19:34:33.689310Z",
     "shell.execute_reply.started": "2022-09-28T19:34:33.684813Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "AnnData object with n_obs × n_vars = 6099 × 34546"
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "65c5aaa9-598f-42ab-8256-a56407736aeb",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "See the [documentation for scanpy pre-processing filter-genes](https://scanpy.readthedocs.io/en/latest/generated/scanpy.pp.filter_genes.html)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "375698ca-d609-4c64-8be3-7f1598d15f74",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:33.691590Z",
     "iopub.status.busy": "2022-09-28T19:34:33.691354Z",
     "iopub.status.idle": "2022-09-28T19:34:34.568548Z",
     "shell.execute_reply": "2022-09-28T19:34:34.567868Z",
     "shell.execute_reply.started": "2022-09-28T19:34:33.691572Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "sc.pp.filter_genes(adata, min_cells=10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "5d4212ba-6dec-4d90-9872-1982e2ead16a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:34.569952Z",
     "iopub.status.busy": "2022-09-28T19:34:34.569664Z",
     "iopub.status.idle": "2022-09-28T19:34:34.574610Z",
     "shell.execute_reply": "2022-09-28T19:34:34.573879Z",
     "shell.execute_reply.started": "2022-09-28T19:34:34.569928Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "AnnData object with n_obs × n_vars = 6099 × 19896\n",
       "    var: 'n_cells'"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6341122f-db4d-4f9b-8387-088d93e5337f",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "Following filtration there are 19896 transcript types remaining that are present in at least 10 cells. This means 14650 transcript types were removed at the threshold of 10. Notice that an annotation named `n_cells` has been added to the genes to indicate the number of cells with non-zero values for that transcript type."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "934c6628-8d55-4795-b7a1-debfbb3a21dc",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:34.576031Z",
     "iopub.status.busy": "2022-09-28T19:34:34.575704Z",
     "iopub.status.idle": "2022-09-28T19:34:34.589304Z",
     "shell.execute_reply": "2022-09-28T19:34:34.588549Z",
     "shell.execute_reply.started": "2022-09-28T19:34:34.576010Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>n_cells</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>AL627309.5</th>\n",
       "      <td>33</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>LINC01409</th>\n",
       "      <td>274</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>LINC01128</th>\n",
       "      <td>81</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>LINC00115</th>\n",
       "      <td>15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>SAMD11</th>\n",
       "      <td>16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MAFIP</th>\n",
       "      <td>34</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AC011043.1</th>\n",
       "      <td>11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AL354822.1</th>\n",
       "      <td>133</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AL592183.1</th>\n",
       "      <td>1003</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AC240274.1</th>\n",
       "      <td>162</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>19896 rows × 1 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "            n_cells\n",
       "AL627309.5       33\n",
       "LINC01409       274\n",
       "LINC01128        81\n",
       "LINC00115        15\n",
       "SAMD11           16\n",
       "...             ...\n",
       "MAFIP            34\n",
       "AC011043.1       11\n",
       "AL354822.1      133\n",
       "AL592183.1     1003\n",
       "AC240274.1      162\n",
       "\n",
       "[19896 rows x 1 columns]"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.var"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "id": "9e1b7e4c-8215-4177-89cb-5f7bd1d198ad",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T20:56:08.961927Z",
     "iopub.status.busy": "2022-09-28T20:56:08.961172Z",
     "iopub.status.idle": "2022-09-28T20:56:08.985761Z",
     "shell.execute_reply": "2022-09-28T20:56:08.984887Z",
     "shell.execute_reply.started": "2022-09-28T20:56:08.961895Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>n_cells</th>\n",
       "      <th>highly_variable_rank</th>\n",
       "      <th>means</th>\n",
       "      <th>variances</th>\n",
       "      <th>variances_norm</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>count</th>\n",
       "      <td>2000.000000</td>\n",
       "      <td>2000.000000</td>\n",
       "      <td>2000.000000</td>\n",
       "      <td>2000.000000</td>\n",
       "      <td>2000.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mean</th>\n",
       "      <td>319.636000</td>\n",
       "      <td>999.500000</td>\n",
       "      <td>0.140495</td>\n",
       "      <td>1.135413</td>\n",
       "      <td>2.203288</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>std</th>\n",
       "      <td>377.720811</td>\n",
       "      <td>577.494568</td>\n",
       "      <td>0.282680</td>\n",
       "      <td>5.619025</td>\n",
       "      <td>1.171426</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>min</th>\n",
       "      <td>10.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.001968</td>\n",
       "      <td>0.002948</td>\n",
       "      <td>1.399341</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25%</th>\n",
       "      <td>65.000000</td>\n",
       "      <td>499.750000</td>\n",
       "      <td>0.017216</td>\n",
       "      <td>0.040875</td>\n",
       "      <td>1.550249</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50%</th>\n",
       "      <td>184.500000</td>\n",
       "      <td>999.500000</td>\n",
       "      <td>0.053123</td>\n",
       "      <td>0.148688</td>\n",
       "      <td>1.828523</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75%</th>\n",
       "      <td>414.000000</td>\n",
       "      <td>1499.250000</td>\n",
       "      <td>0.148426</td>\n",
       "      <td>0.545860</td>\n",
       "      <td>2.346181</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>max</th>\n",
       "      <td>4546.000000</td>\n",
       "      <td>1999.000000</td>\n",
       "      <td>5.314150</td>\n",
       "      <td>135.394535</td>\n",
       "      <td>17.115198</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "           n_cells  highly_variable_rank        means    variances  \\\n",
       "count  2000.000000           2000.000000  2000.000000  2000.000000   \n",
       "mean    319.636000            999.500000     0.140495     1.135413   \n",
       "std     377.720811            577.494568     0.282680     5.619025   \n",
       "min      10.000000              0.000000     0.001968     0.002948   \n",
       "25%      65.000000            499.750000     0.017216     0.040875   \n",
       "50%     184.500000            999.500000     0.053123     0.148688   \n",
       "75%     414.000000           1499.250000     0.148426     0.545860   \n",
       "max    4546.000000           1999.000000     5.314150   135.394535   \n",
       "\n",
       "       variances_norm  \n",
       "count     2000.000000  \n",
       "mean         2.203288  \n",
       "std          1.171426  \n",
       "min          1.399341  \n",
       "25%          1.550249  \n",
       "50%          1.828523  \n",
       "75%          2.346181  \n",
       "max         17.115198  "
      ]
     },
     "execution_count": 45,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.var.describe()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "id": "1ea63d81-6cf8-44b4-a069-58b55d0899d1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T20:56:52.294232Z",
     "iopub.status.busy": "2022-09-28T20:56:52.293876Z",
     "iopub.status.idle": "2022-09-28T20:56:52.559327Z",
     "shell.execute_reply": "2022-09-28T20:56:52.558542Z",
     "shell.execute_reply.started": "2022-09-28T20:56:52.294206Z"
    },
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<AxesSubplot:xlabel='n_cells', ylabel='Count'>"
      ]
     },
     "execution_count": 47,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/svg+xml": [
       "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"no\"?>\n",
       "<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n",
       "  \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n",
       "<svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"419.305pt\" height=\"319.962pt\" viewBox=\"0 0 419.305 319.962\" xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">\n",
       " <metadata>\n",
       "  <rdf:RDF xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:cc=\"http://creativecommons.org/ns#\" xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\">\n",
       "   <cc:Work>\n",
       "    <dc:type rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\"/>\n",
       "    <dc:date>2022-09-28T20:56:52.509914</dc:date>\n",
       "    <dc:format>image/svg+xml</dc:format>\n",
       "    <dc:creator>\n",
       "     <cc:Agent>\n",
       "      <dc:title>Matplotlib v3.5.2, https://matplotlib.org/</dc:title>\n",
       "     </cc:Agent>\n",
       "    </dc:creator>\n",
       "   </cc:Work>\n",
       "  </rdf:RDF>\n",
       " </metadata>\n",
       " <defs>\n",
       "  <style type=\"text/css\">*{stroke-linejoin: round; stroke-linecap: butt}</style>\n",
       " </defs>\n",
       " <g id=\"figure_1\">\n",
       "  <g id=\"patch_1\">\n",
       "   <path d=\"M 0 319.962 \n",
       "L 419.305 319.962 \n",
       "L 419.305 0 \n",
       "L 0 0 \n",
       "z\n",
       "\" style=\"fill: #ffffff\"/>\n",
       "  </g>\n",
       "  <g id=\"axes_1\">\n",
       "   <g id=\"patch_2\">\n",
       "    <path d=\"M 54.985 273.312 \n",
       "L 412.105 273.312 \n",
       "L 412.105 7.2 \n",
       "L 54.985 7.2 \n",
       "z\n",
       "\" style=\"fill: #ffffff\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_3\">\n",
       "    <path d=\"M 71.217727 273.312 \n",
       "L 75.176929 273.312 \n",
       "L 75.176929 19.872 \n",
       "L 71.217727 19.872 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_4\">\n",
       "    <path d=\"M 75.176929 273.312 \n",
       "L 79.136131 273.312 \n",
       "L 79.136131 142.066286 \n",
       "L 75.176929 142.066286 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_5\">\n",
       "    <path d=\"M 79.136131 273.312 \n",
       "L 83.095333 273.312 \n",
       "L 83.095333 169.220571 \n",
       "L 79.136131 169.220571 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_6\">\n",
       "    <path d=\"M 83.095333 273.312 \n",
       "L 87.054534 273.312 \n",
       "L 87.054534 190.340571 \n",
       "L 83.095333 190.340571 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_7\">\n",
       "    <path d=\"M 87.054534 273.312 \n",
       "L 91.013736 273.312 \n",
       "L 91.013736 207.940571 \n",
       "L 87.054534 207.940571 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_8\">\n",
       "    <path d=\"M 91.013736 273.312 \n",
       "L 94.972938 273.312 \n",
       "L 94.972938 212.466286 \n",
       "L 91.013736 212.466286 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_9\">\n",
       "    <path d=\"M 94.972938 273.312 \n",
       "L 98.93214 273.312 \n",
       "L 98.93214 230.066286 \n",
       "L 94.972938 230.066286 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_10\">\n",
       "    <path d=\"M 98.93214 273.312 \n",
       "L 102.891341 273.312 \n",
       "L 102.891341 238.112 \n",
       "L 98.93214 238.112 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_11\">\n",
       "    <path d=\"M 102.891341 273.312 \n",
       "L 106.850543 273.312 \n",
       "L 106.850543 249.677714 \n",
       "L 102.891341 249.677714 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_12\">\n",
       "    <path d=\"M 106.850543 273.312 \n",
       "L 110.809745 273.312 \n",
       "L 110.809745 250.180571 \n",
       "L 106.850543 250.180571 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_13\">\n",
       "    <path d=\"M 110.809745 273.312 \n",
       "L 114.768947 273.312 \n",
       "L 114.768947 252.694857 \n",
       "L 110.809745 252.694857 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_14\">\n",
       "    <path d=\"M 114.768947 273.312 \n",
       "L 118.728149 273.312 \n",
       "L 118.728149 256.214857 \n",
       "L 114.768947 256.214857 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_15\">\n",
       "    <path d=\"M 118.728149 273.312 \n",
       "L 122.68735 273.312 \n",
       "L 122.68735 256.214857 \n",
       "L 118.728149 256.214857 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_16\">\n",
       "    <path d=\"M 122.68735 273.312 \n",
       "L 126.646552 273.312 \n",
       "L 126.646552 262.752 \n",
       "L 122.68735 262.752 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_17\">\n",
       "    <path d=\"M 126.646552 273.312 \n",
       "L 130.605754 273.312 \n",
       "L 130.605754 258.226286 \n",
       "L 126.646552 258.226286 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_18\">\n",
       "    <path d=\"M 130.605754 273.312 \n",
       "L 134.564956 273.312 \n",
       "L 134.564956 254.203429 \n",
       "L 130.605754 254.203429 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_19\">\n",
       "    <path d=\"M 134.564956 273.312 \n",
       "L 138.524157 273.312 \n",
       "L 138.524157 261.243429 \n",
       "L 134.564956 261.243429 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_20\">\n",
       "    <path d=\"M 138.524157 273.312 \n",
       "L 142.483359 273.312 \n",
       "L 142.483359 261.746286 \n",
       "L 138.524157 261.746286 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_21\">\n",
       "    <path d=\"M 142.483359 273.312 \n",
       "L 146.442561 273.312 \n",
       "L 146.442561 266.774857 \n",
       "L 142.483359 266.774857 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_22\">\n",
       "    <path d=\"M 146.442561 273.312 \n",
       "L 150.401763 273.312 \n",
       "L 150.401763 268.786286 \n",
       "L 146.442561 268.786286 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_23\">\n",
       "    <path d=\"M 150.401763 273.312 \n",
       "L 154.360965 273.312 \n",
       "L 154.360965 268.786286 \n",
       "L 150.401763 268.786286 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_24\">\n",
       "    <path d=\"M 154.360965 273.312 \n",
       "L 158.320166 273.312 \n",
       "L 158.320166 266.272 \n",
       "L 154.360965 266.272 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_25\">\n",
       "    <path d=\"M 158.320166 273.312 \n",
       "L 162.279368 273.312 \n",
       "L 162.279368 269.289143 \n",
       "L 158.320166 269.289143 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_26\">\n",
       "    <path d=\"M 162.279368 273.312 \n",
       "L 166.23857 273.312 \n",
       "L 166.23857 267.780571 \n",
       "L 162.279368 267.780571 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_27\">\n",
       "    <path d=\"M 166.23857 273.312 \n",
       "L 170.197772 273.312 \n",
       "L 170.197772 269.289143 \n",
       "L 166.23857 269.289143 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_28\">\n",
       "    <path d=\"M 170.197772 273.312 \n",
       "L 174.156973 273.312 \n",
       "L 174.156973 270.294857 \n",
       "L 170.197772 270.294857 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_29\">\n",
       "    <path d=\"M 174.156973 273.312 \n",
       "L 178.116175 273.312 \n",
       "L 178.116175 270.797714 \n",
       "L 174.156973 270.797714 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_30\">\n",
       "    <path d=\"M 178.116175 273.312 \n",
       "L 182.075377 273.312 \n",
       "L 182.075377 270.797714 \n",
       "L 178.116175 270.797714 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_31\">\n",
       "    <path d=\"M 182.075377 273.312 \n",
       "L 186.034579 273.312 \n",
       "L 186.034579 270.797714 \n",
       "L 182.075377 270.797714 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_32\">\n",
       "    <path d=\"M 186.034579 273.312 \n",
       "L 189.99378 273.312 \n",
       "L 189.99378 271.803429 \n",
       "L 186.034579 271.803429 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_33\">\n",
       "    <path d=\"M 189.99378 273.312 \n",
       "L 193.952982 273.312 \n",
       "L 193.952982 270.797714 \n",
       "L 189.99378 270.797714 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_34\">\n",
       "    <path d=\"M 193.952982 273.312 \n",
       "L 197.912184 273.312 \n",
       "L 197.912184 272.809143 \n",
       "L 193.952982 272.809143 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_35\">\n",
       "    <path d=\"M 197.912184 273.312 \n",
       "L 201.871386 273.312 \n",
       "L 201.871386 272.306286 \n",
       "L 197.912184 272.306286 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_36\">\n",
       "    <path d=\"M 201.871386 273.312 \n",
       "L 205.830588 273.312 \n",
       "L 205.830588 271.300571 \n",
       "L 201.871386 271.300571 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_37\">\n",
       "    <path d=\"M 205.830588 273.312 \n",
       "L 209.789789 273.312 \n",
       "L 209.789789 273.312 \n",
       "L 205.830588 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_38\">\n",
       "    <path d=\"M 209.789789 273.312 \n",
       "L 213.748991 273.312 \n",
       "L 213.748991 271.803429 \n",
       "L 209.789789 271.803429 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_39\">\n",
       "    <path d=\"M 213.748991 273.312 \n",
       "L 217.708193 273.312 \n",
       "L 217.708193 273.312 \n",
       "L 213.748991 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_40\">\n",
       "    <path d=\"M 217.708193 273.312 \n",
       "L 221.667395 273.312 \n",
       "L 221.667395 272.809143 \n",
       "L 217.708193 272.809143 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_41\">\n",
       "    <path d=\"M 221.667395 273.312 \n",
       "L 225.626596 273.312 \n",
       "L 225.626596 272.809143 \n",
       "L 221.667395 272.809143 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_42\">\n",
       "    <path d=\"M 225.626596 273.312 \n",
       "L 229.585798 273.312 \n",
       "L 229.585798 272.306286 \n",
       "L 225.626596 272.306286 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_43\">\n",
       "    <path d=\"M 229.585798 273.312 \n",
       "L 233.545 273.312 \n",
       "L 233.545 273.312 \n",
       "L 229.585798 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_44\">\n",
       "    <path d=\"M 233.545 273.312 \n",
       "L 237.504202 273.312 \n",
       "L 237.504202 272.809143 \n",
       "L 233.545 272.809143 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_45\">\n",
       "    <path d=\"M 237.504202 273.312 \n",
       "L 241.463404 273.312 \n",
       "L 241.463404 273.312 \n",
       "L 237.504202 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_46\">\n",
       "    <path d=\"M 241.463404 273.312 \n",
       "L 245.422605 273.312 \n",
       "L 245.422605 273.312 \n",
       "L 241.463404 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_47\">\n",
       "    <path d=\"M 245.422605 273.312 \n",
       "L 249.381807 273.312 \n",
       "L 249.381807 273.312 \n",
       "L 245.422605 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_48\">\n",
       "    <path d=\"M 249.381807 273.312 \n",
       "L 253.341009 273.312 \n",
       "L 253.341009 272.809143 \n",
       "L 249.381807 272.809143 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_49\">\n",
       "    <path d=\"M 253.341009 273.312 \n",
       "L 257.300211 273.312 \n",
       "L 257.300211 273.312 \n",
       "L 253.341009 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_50\">\n",
       "    <path d=\"M 257.300211 273.312 \n",
       "L 261.259412 273.312 \n",
       "L 261.259412 273.312 \n",
       "L 257.300211 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_51\">\n",
       "    <path d=\"M 261.259412 273.312 \n",
       "L 265.218614 273.312 \n",
       "L 265.218614 273.312 \n",
       "L 261.259412 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_52\">\n",
       "    <path d=\"M 265.218614 273.312 \n",
       "L 269.177816 273.312 \n",
       "L 269.177816 273.312 \n",
       "L 265.218614 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_53\">\n",
       "    <path d=\"M 269.177816 273.312 \n",
       "L 273.137018 273.312 \n",
       "L 273.137018 273.312 \n",
       "L 269.177816 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_54\">\n",
       "    <path d=\"M 273.137018 273.312 \n",
       "L 277.09622 273.312 \n",
       "L 277.09622 273.312 \n",
       "L 273.137018 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_55\">\n",
       "    <path d=\"M 277.09622 273.312 \n",
       "L 281.055421 273.312 \n",
       "L 281.055421 273.312 \n",
       "L 277.09622 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_56\">\n",
       "    <path d=\"M 281.055421 273.312 \n",
       "L 285.014623 273.312 \n",
       "L 285.014623 273.312 \n",
       "L 281.055421 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_57\">\n",
       "    <path d=\"M 285.014623 273.312 \n",
       "L 288.973825 273.312 \n",
       "L 288.973825 273.312 \n",
       "L 285.014623 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_58\">\n",
       "    <path d=\"M 288.973825 273.312 \n",
       "L 292.933027 273.312 \n",
       "L 292.933027 273.312 \n",
       "L 288.973825 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_59\">\n",
       "    <path d=\"M 292.933027 273.312 \n",
       "L 296.892228 273.312 \n",
       "L 296.892228 273.312 \n",
       "L 292.933027 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_60\">\n",
       "    <path d=\"M 296.892228 273.312 \n",
       "L 300.85143 273.312 \n",
       "L 300.85143 273.312 \n",
       "L 296.892228 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_61\">\n",
       "    <path d=\"M 300.85143 273.312 \n",
       "L 304.810632 273.312 \n",
       "L 304.810632 273.312 \n",
       "L 300.85143 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_62\">\n",
       "    <path d=\"M 304.810632 273.312 \n",
       "L 308.769834 273.312 \n",
       "L 308.769834 273.312 \n",
       "L 304.810632 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_63\">\n",
       "    <path d=\"M 308.769834 273.312 \n",
       "L 312.729035 273.312 \n",
       "L 312.729035 273.312 \n",
       "L 308.769834 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_64\">\n",
       "    <path d=\"M 312.729035 273.312 \n",
       "L 316.688237 273.312 \n",
       "L 316.688237 273.312 \n",
       "L 312.729035 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_65\">\n",
       "    <path d=\"M 316.688237 273.312 \n",
       "L 320.647439 273.312 \n",
       "L 320.647439 273.312 \n",
       "L 316.688237 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_66\">\n",
       "    <path d=\"M 320.647439 273.312 \n",
       "L 324.606641 273.312 \n",
       "L 324.606641 273.312 \n",
       "L 320.647439 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_67\">\n",
       "    <path d=\"M 324.606641 273.312 \n",
       "L 328.565843 273.312 \n",
       "L 328.565843 273.312 \n",
       "L 324.606641 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_68\">\n",
       "    <path d=\"M 328.565843 273.312 \n",
       "L 332.525044 273.312 \n",
       "L 332.525044 273.312 \n",
       "L 328.565843 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_69\">\n",
       "    <path d=\"M 332.525044 273.312 \n",
       "L 336.484246 273.312 \n",
       "L 336.484246 273.312 \n",
       "L 332.525044 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_70\">\n",
       "    <path d=\"M 336.484246 273.312 \n",
       "L 340.443448 273.312 \n",
       "L 340.443448 273.312 \n",
       "L 336.484246 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_71\">\n",
       "    <path d=\"M 340.443448 273.312 \n",
       "L 344.40265 273.312 \n",
       "L 344.40265 273.312 \n",
       "L 340.443448 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_72\">\n",
       "    <path d=\"M 344.40265 273.312 \n",
       "L 348.361851 273.312 \n",
       "L 348.361851 273.312 \n",
       "L 344.40265 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_73\">\n",
       "    <path d=\"M 348.361851 273.312 \n",
       "L 352.321053 273.312 \n",
       "L 352.321053 273.312 \n",
       "L 348.361851 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_74\">\n",
       "    <path d=\"M 352.321053 273.312 \n",
       "L 356.280255 273.312 \n",
       "L 356.280255 273.312 \n",
       "L 352.321053 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_75\">\n",
       "    <path d=\"M 356.280255 273.312 \n",
       "L 360.239457 273.312 \n",
       "L 360.239457 273.312 \n",
       "L 356.280255 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_76\">\n",
       "    <path d=\"M 360.239457 273.312 \n",
       "L 364.198659 273.312 \n",
       "L 364.198659 273.312 \n",
       "L 360.239457 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_77\">\n",
       "    <path d=\"M 364.198659 273.312 \n",
       "L 368.15786 273.312 \n",
       "L 368.15786 273.312 \n",
       "L 364.198659 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_78\">\n",
       "    <path d=\"M 368.15786 273.312 \n",
       "L 372.117062 273.312 \n",
       "L 372.117062 273.312 \n",
       "L 368.15786 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_79\">\n",
       "    <path d=\"M 372.117062 273.312 \n",
       "L 376.076264 273.312 \n",
       "L 376.076264 273.312 \n",
       "L 372.117062 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_80\">\n",
       "    <path d=\"M 376.076264 273.312 \n",
       "L 380.035466 273.312 \n",
       "L 380.035466 273.312 \n",
       "L 376.076264 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_81\">\n",
       "    <path d=\"M 380.035466 273.312 \n",
       "L 383.994667 273.312 \n",
       "L 383.994667 273.312 \n",
       "L 380.035466 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_82\">\n",
       "    <path d=\"M 383.994667 273.312 \n",
       "L 387.953869 273.312 \n",
       "L 387.953869 273.312 \n",
       "L 383.994667 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_83\">\n",
       "    <path d=\"M 387.953869 273.312 \n",
       "L 391.913071 273.312 \n",
       "L 391.913071 273.312 \n",
       "L 387.953869 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_84\">\n",
       "    <path d=\"M 391.913071 273.312 \n",
       "L 395.872273 273.312 \n",
       "L 395.872273 272.809143 \n",
       "L 391.913071 272.809143 \n",
       "z\n",
       "\" clip-path=\"url(#p295444a204)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-width: 0.39592; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"matplotlib.axis_1\">\n",
       "    <g id=\"xtick_1\">\n",
       "     <g id=\"line2d_1\">\n",
       "      <defs>\n",
       "       <path id=\"m1a318aabd5\" d=\"M 0 0 \n",
       "L 0 3.5 \n",
       "\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </defs>\n",
       "      <g>\n",
       "       <use xlink:href=\"#m1a318aabd5\" x=\"70.501999\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_1\">\n",
       "      <!-- 0 -->\n",
       "      <g transform=\"translate(66.741999 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-30\" d=\"M 2758 2093 \n",
       "C 2758 2458 2752 3136 2490 3661 \n",
       "C 2227 4166 1805 4301 1504 4301 \n",
       "C 1069 4301 698 4045 506 3635 \n",
       "C 301 3206 243 2765 243 2093 \n",
       "C 243 1632 262 1069 493 576 \n",
       "C 755 32 1197 -102 1498 -102 \n",
       "C 1894 -102 2278 109 2496 550 \n",
       "C 2720 1011 2758 1517 2758 2093 \n",
       "z\n",
       "M 2272 2163 \n",
       "C 2272 1568 2272 288 1498 288 \n",
       "C 1011 288 864 845 819 1030 \n",
       "C 742 1350 730 1658 730 2163 \n",
       "C 730 2560 730 3008 851 3360 \n",
       "C 998 3770 1254 3910 1498 3910 \n",
       "C 1971 3910 2125 3437 2176 3270 \n",
       "C 2272 2931 2272 2534 2272 2163 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_2\">\n",
       "     <g id=\"line2d_2\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m1a318aabd5\" x=\"142.07487\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_2\">\n",
       "      <!-- 1000 -->\n",
       "      <g transform=\"translate(127.03487 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-31\" d=\"M 2573 0 \n",
       "L 2573 371 \n",
       "L 1818 371 \n",
       "L 1818 4301 \n",
       "L 1696 4301 \n",
       "C 1350 3942 947 3891 538 3878 \n",
       "L 538 3507 \n",
       "C 723 3514 1024 3526 1325 3661 \n",
       "L 1325 371 \n",
       "L 570 371 \n",
       "L 570 0 \n",
       "L 2573 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-31\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"140.999954\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_3\">\n",
       "     <g id=\"line2d_3\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m1a318aabd5\" x=\"213.647742\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_3\">\n",
       "      <!-- 2000 -->\n",
       "      <g transform=\"translate(198.607742 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-32\" d=\"M 2701 0 \n",
       "L 2701 435 \n",
       "L 1613 435 \n",
       "C 1536 435 1459 429 1382 429 \n",
       "L 742 429 \n",
       "L 742 435 \n",
       "L 1651 1357 \n",
       "C 1830 1542 2099 1766 2285 1990 \n",
       "C 2464 2208 2701 2515 2701 2963 \n",
       "C 2701 3667 2227 4301 1421 4301 \n",
       "C 787 4301 422 3904 250 3283 \n",
       "L 499 2938 \n",
       "C 640 3520 838 3891 1338 3891 \n",
       "C 1888 3891 2195 3443 2195 2950 \n",
       "C 2195 2362 1747 1907 1408 1568 \n",
       "L 301 410 \n",
       "L 301 0 \n",
       "L 2701 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-32\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"140.999954\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_4\">\n",
       "     <g id=\"line2d_4\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m1a318aabd5\" x=\"285.220613\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_4\">\n",
       "      <!-- 3000 -->\n",
       "      <g transform=\"translate(270.180613 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-33\" d=\"M 2752 1178 \n",
       "C 2752 1683 2400 2106 1920 2266 \n",
       "C 2304 2477 2586 2874 2586 3334 \n",
       "C 2586 3872 2093 4301 1491 4301 \n",
       "C 941 4301 512 3962 333 3597 \n",
       "C 378 3533 493 3347 550 3251 \n",
       "C 691 3629 1056 3910 1485 3910 \n",
       "C 1843 3910 2080 3674 2080 3334 \n",
       "C 2080 2982 1856 2598 1478 2509 \n",
       "C 1453 2509 1056 2470 1005 2464 \n",
       "L 1005 2074 \n",
       "L 1440 2074 \n",
       "C 2042 2074 2214 1549 2214 1184 \n",
       "C 2214 685 1933 294 1472 294 \n",
       "C 1114 294 608 474 320 947 \n",
       "C 275 723 275 710 250 557 \n",
       "C 550 115 1037 -102 1485 -102 \n",
       "C 2214 -102 2752 506 2752 1178 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-33\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"140.999954\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_5\">\n",
       "     <g id=\"line2d_5\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m1a318aabd5\" x=\"356.793485\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_5\">\n",
       "      <!-- 4000 -->\n",
       "      <g transform=\"translate(341.753485 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-34\" d=\"M 2835 1094 \n",
       "L 2835 1485 \n",
       "L 2253 1485 \n",
       "L 2253 4198 \n",
       "L 1690 4198 \n",
       "L 166 1485 \n",
       "L 166 1094 \n",
       "L 1747 1094 \n",
       "L 1747 0 \n",
       "L 2253 0 \n",
       "L 2253 1094 \n",
       "L 2835 1094 \n",
       "z\n",
       "M 1766 1485 \n",
       "L 659 1485 \n",
       "C 1030 2138 1760 3456 1766 3904 \n",
       "L 1766 1485 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-34\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"140.999954\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"text_6\">\n",
       "     <!-- n_cells -->\n",
       "     <g transform=\"translate(211.5375 309.642)scale(0.16 -0.16)\">\n",
       "      <defs>\n",
       "       <path id=\"LMSans17-Regular-6e\" d=\"M 2618 0 \n",
       "L 2618 1869 \n",
       "C 2618 2272 2522 2803 1798 2803 \n",
       "C 1389 2803 1120 2592 941 2374 \n",
       "L 941 2771 \n",
       "L 474 2771 \n",
       "L 474 0 \n",
       "L 960 0 \n",
       "L 960 1549 \n",
       "C 960 1952 1114 2413 1549 2413 \n",
       "C 2112 2413 2131 2035 2131 1818 \n",
       "L 2131 0 \n",
       "L 2618 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-5f\" d=\"M 4000 -1043 \n",
       "L 4000 -557 \n",
       "L 0 -557 \n",
       "L 0 -1043 \n",
       "L 4000 -1043 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-63\" d=\"M 2502 256 \n",
       "L 2464 678 \n",
       "C 2189 467 1869 352 1523 352 \n",
       "C 1024 352 698 787 698 1382 \n",
       "C 698 1843 909 2426 1549 2426 \n",
       "C 1901 2426 2099 2355 2394 2157 \n",
       "L 2464 2554 \n",
       "C 2464 2598 2170 2726 2093 2752 \n",
       "C 1882 2829 1613 2829 1542 2829 \n",
       "C 710 2829 211 2106 211 1376 \n",
       "C 211 608 768 -51 1517 -51 \n",
       "C 1946 -51 2253 90 2502 256 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-65\" d=\"M 2502 1402 \n",
       "C 2502 1613 2490 2022 2285 2362 \n",
       "C 2061 2726 1696 2829 1421 2829 \n",
       "C 755 2829 192 2202 192 1389 \n",
       "C 192 595 774 -51 1510 -51 \n",
       "C 1798 -51 2150 32 2470 262 \n",
       "C 2470 288 2451 435 2451 435 \n",
       "C 2451 435 2432 646 2432 672 \n",
       "C 2125 422 1773 339 1517 339 \n",
       "C 1107 339 666 685 646 1402 \n",
       "L 2502 1402 \n",
       "z\n",
       "M 2080 1754 \n",
       "L 698 1754 \n",
       "C 781 2106 1062 2438 1421 2438 \n",
       "C 1517 2438 1965 2426 2080 1754 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-6c\" d=\"M 947 0 \n",
       "L 947 4442 \n",
       "L 474 4442 \n",
       "L 474 0 \n",
       "L 947 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-73\" d=\"M 2163 794 \n",
       "C 2163 1107 1984 1318 1862 1414 \n",
       "C 1651 1581 1574 1600 1050 1709 \n",
       "C 960 1722 646 1792 646 2080 \n",
       "C 646 2445 1050 2445 1139 2445 \n",
       "C 1555 2445 1811 2317 1984 2221 \n",
       "L 2061 2637 \n",
       "C 1683 2816 1389 2829 1197 2829 \n",
       "C 742 2829 198 2669 198 2022 \n",
       "C 198 1376 902 1235 1094 1197 \n",
       "C 1389 1139 1715 1075 1715 755 \n",
       "C 1715 352 1254 352 1171 352 \n",
       "C 915 352 563 422 243 653 \n",
       "L 166 224 \n",
       "C 531 13 883 -51 1178 -51 \n",
       "C 1965 -51 2163 429 2163 794 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "      </defs>\n",
       "      <use xlink:href=\"#LMSans17-Regular-6e\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-5f\" x=\"48.399994\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-63\" x=\"110.899979\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-65\" x=\"152.699966\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-6c\" x=\"194.499954\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-6c\" x=\"216.799942\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-73\" x=\"239.09993\"/>\n",
       "     </g>\n",
       "    </g>\n",
       "   </g>\n",
       "   <g id=\"matplotlib.axis_2\">\n",
       "    <g id=\"ytick_1\">\n",
       "     <g id=\"line2d_6\">\n",
       "      <defs>\n",
       "       <path id=\"md2ce867aff\" d=\"M 0 0 \n",
       "L -3.5 0 \n",
       "\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </defs>\n",
       "      <g>\n",
       "       <use xlink:href=\"#md2ce867aff\" x=\"54.985\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_7\">\n",
       "      <!-- 0 -->\n",
       "      <g transform=\"translate(40.465 278.8645)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_2\">\n",
       "     <g id=\"line2d_7\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#md2ce867aff\" x=\"54.985\" y=\"223.026286\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_8\">\n",
       "      <!-- 100 -->\n",
       "      <g transform=\"translate(25.425 228.578786)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-31\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_3\">\n",
       "     <g id=\"line2d_8\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#md2ce867aff\" x=\"54.985\" y=\"172.740571\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_9\">\n",
       "      <!-- 200 -->\n",
       "      <g transform=\"translate(25.425 178.293071)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-32\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_4\">\n",
       "     <g id=\"line2d_9\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#md2ce867aff\" x=\"54.985\" y=\"122.454857\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_10\">\n",
       "      <!-- 300 -->\n",
       "      <g transform=\"translate(25.425 128.007357)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-33\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_5\">\n",
       "     <g id=\"line2d_10\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#md2ce867aff\" x=\"54.985\" y=\"72.169143\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_11\">\n",
       "      <!-- 400 -->\n",
       "      <g transform=\"translate(25.425 77.721643)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-34\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_6\">\n",
       "     <g id=\"line2d_11\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#md2ce867aff\" x=\"54.985\" y=\"21.883429\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_12\">\n",
       "      <!-- 500 -->\n",
       "      <g transform=\"translate(25.425 27.435929)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-35\" d=\"M 2701 1299 \n",
       "C 2701 2086 2182 2694 1562 2694 \n",
       "C 1338 2694 1120 2618 934 2464 \n",
       "L 934 3789 \n",
       "L 2502 3789 \n",
       "L 2502 4198 \n",
       "L 467 4198 \n",
       "L 467 1837 \n",
       "L 896 1837 \n",
       "C 1011 2106 1248 2304 1555 2304 \n",
       "C 1843 2304 2163 2048 2163 1312 \n",
       "C 2163 525 1709 294 1376 294 \n",
       "C 966 294 589 544 422 890 \n",
       "L 218 531 \n",
       "C 512 77 992 -102 1376 -102 \n",
       "C 2118 -102 2701 531 2701 1299 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-35\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"text_13\">\n",
       "     <!-- Count -->\n",
       "     <g transform=\"translate(18.305 159.2885)rotate(-90)scale(0.16 -0.16)\">\n",
       "      <defs>\n",
       "       <path id=\"LMSans17-Regular-43\" d=\"M 3501 301 \n",
       "L 3462 736 \n",
       "C 3290 614 3123 493 2918 429 \n",
       "C 2720 365 2515 358 2310 358 \n",
       "C 1920 358 1568 582 1338 896 \n",
       "C 1050 1274 922 1734 922 2195 \n",
       "C 922 2662 1050 3130 1338 3501 \n",
       "C 1568 3808 1920 4038 2310 4038 \n",
       "C 2496 4038 2675 4019 2848 3962 \n",
       "C 3027 3910 3187 3814 3347 3718 \n",
       "L 3437 4230 \n",
       "C 3258 4301 3072 4358 2880 4397 \n",
       "C 2694 4435 2502 4448 2310 4448 \n",
       "C 1786 4448 1299 4192 954 3789 \n",
       "C 576 3347 390 2778 390 2195 \n",
       "C 390 1619 576 1050 954 608 \n",
       "C 1299 205 1786 -51 2310 -51 \n",
       "C 2522 -51 2733 -45 2938 13 \n",
       "C 3142 77 3322 186 3501 301 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-6f\" d=\"M 2829 1370 \n",
       "C 2829 2189 2221 2829 1504 2829 \n",
       "C 768 2829 173 2170 173 1370 \n",
       "C 173 557 787 -51 1498 -51 \n",
       "C 2227 -51 2829 576 2829 1370 \n",
       "z\n",
       "M 2342 1421 \n",
       "C 2342 698 1926 346 1498 346 \n",
       "C 1050 346 659 723 659 1421 \n",
       "C 659 2163 1114 2432 1498 2432 \n",
       "C 1914 2432 2342 2138 2342 1421 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-75\" d=\"M 2618 0 \n",
       "L 2618 2752 \n",
       "L 2131 2752 \n",
       "L 2131 986 \n",
       "C 2131 512 1786 320 1421 320 \n",
       "C 998 320 960 461 960 723 \n",
       "L 960 2752 \n",
       "L 474 2752 \n",
       "L 474 691 \n",
       "C 474 192 646 -51 1088 -51 \n",
       "C 1306 -51 1798 0 2144 320 \n",
       "L 2144 0 \n",
       "L 2618 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-74\" d=\"M 2003 186 \n",
       "L 1901 563 \n",
       "C 1747 429 1562 352 1363 352 \n",
       "C 1082 352 1069 710 1069 870 \n",
       "L 1069 2381 \n",
       "L 1901 2381 \n",
       "L 1901 2752 \n",
       "L 1069 2752 \n",
       "L 1069 3539 \n",
       "L 614 3539 \n",
       "L 614 2752 \n",
       "L 109 2752 \n",
       "L 109 2381 \n",
       "L 602 2381 \n",
       "L 602 762 \n",
       "C 602 397 685 -51 1107 -51 \n",
       "C 1427 -51 1722 38 2003 186 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "      </defs>\n",
       "      <use xlink:href=\"#LMSans17-Regular-43\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-6f\" x=\"60.099991\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-75\" x=\"107.099976\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-6e\" x=\"155.499969\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-74\" x=\"203.899963\"/>\n",
       "     </g>\n",
       "    </g>\n",
       "   </g>\n",
       "   <g id=\"patch_85\">\n",
       "    <path d=\"M 54.985 273.312 \n",
       "L 54.985 7.2 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_86\">\n",
       "    <path d=\"M 412.105 273.312 \n",
       "L 412.105 7.2 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_87\">\n",
       "    <path d=\"M 54.985 273.312 \n",
       "L 412.105 273.312 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_88\">\n",
       "    <path d=\"M 54.985 7.2 \n",
       "L 412.105 7.2 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "  </g>\n",
       " </g>\n",
       " <defs>\n",
       "  <clipPath id=\"p295444a204\">\n",
       "   <rect x=\"54.985\" y=\"7.2\" width=\"357.12\" height=\"266.112\"/>\n",
       "  </clipPath>\n",
       " </defs>\n",
       "</svg>\n"
      ],
      "text/plain": [
       "<Figure size 640x480 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "sns.histplot(adata.var['n_cells'])"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9bfaa5a4-919c-4677-bc3a-b83ce2d4d451",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "### Select highly variable genes"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a2cb808b-5fee-4f01-9c82-79e4ec88f3a3",
   "metadata": {},
   "source": [
    "It is common to select transcript types with high variability among the cell population under the assumption that this will help to focus on features that distinguish the cells. Again there is no perfect threshold. Here we select the 2000 highest variability genes."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "073daaa8-3c88-4f81-9d95-d4932cc001f3",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:34.590823Z",
     "iopub.status.busy": "2022-09-28T19:34:34.590449Z",
     "iopub.status.idle": "2022-09-28T19:34:34.595458Z",
     "shell.execute_reply": "2022-09-28T19:34:34.594750Z",
     "shell.execute_reply.started": "2022-09-28T19:34:34.590802Z"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "AnnData object with n_obs × n_vars = 6099 × 19896\n",
       "    var: 'n_cells'"
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "484cd41f-c198-4b79-9542-dfc440c61808",
   "metadata": {},
   "source": [
    "See the [documentation for scanpy pre-processing highly-variable-genes](https://scanpy.readthedocs.io/en/latest/generated/scanpy.pp.highly_variable_genes.html)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "82a5c4d5-a23c-42a6-b04e-c92e8a303ada",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:34.596586Z",
     "iopub.status.busy": "2022-09-28T19:34:34.596380Z",
     "iopub.status.idle": "2022-09-28T19:34:38.139268Z",
     "shell.execute_reply": "2022-09-28T19:34:38.138560Z",
     "shell.execute_reply.started": "2022-09-28T19:34:34.596568Z"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "sc.pp.highly_variable_genes(adata, n_top_genes=2000, subset=True, flavor=\"seurat_v3\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "eab58f44-688d-49c0-8f24-efa51df548ac",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:38.140704Z",
     "iopub.status.busy": "2022-09-28T19:34:38.140440Z",
     "iopub.status.idle": "2022-09-28T19:34:38.145582Z",
     "shell.execute_reply": "2022-09-28T19:34:38.144872Z",
     "shell.execute_reply.started": "2022-09-28T19:34:38.140681Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "AnnData object with n_obs × n_vars = 6099 × 2000\n",
       "    var: 'n_cells', 'highly_variable', 'highly_variable_rank', 'means', 'variances', 'variances_norm'\n",
       "    uns: 'hvg'"
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ee8beea9-ad64-479f-80df-9c0648e72ca9",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "We have filtered down to 2000 transcript types and added 5 annotations to the genes including a binary variable indicating membership in the highly-variable class, the ranking among highly variable genes, and the mean, variance, and normalized variance for each gene across cells."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "10164845-6cdd-4172-a711-05a3e03319d4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:38.146789Z",
     "iopub.status.busy": "2022-09-28T19:34:38.146558Z",
     "iopub.status.idle": "2022-09-28T19:34:38.159262Z",
     "shell.execute_reply": "2022-09-28T19:34:38.158432Z",
     "shell.execute_reply.started": "2022-09-28T19:34:38.146769Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>n_cells</th>\n",
       "      <th>highly_variable</th>\n",
       "      <th>highly_variable_rank</th>\n",
       "      <th>means</th>\n",
       "      <th>variances</th>\n",
       "      <th>variances_norm</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>TTLL10</th>\n",
       "      <td>112</td>\n",
       "      <td>True</td>\n",
       "      <td>903.0</td>\n",
       "      <td>0.028857</td>\n",
       "      <td>0.069354</td>\n",
       "      <td>1.901045</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TNFRSF18</th>\n",
       "      <td>15</td>\n",
       "      <td>True</td>\n",
       "      <td>1604.0</td>\n",
       "      <td>0.002951</td>\n",
       "      <td>0.004911</td>\n",
       "      <td>1.513808</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CFAP74</th>\n",
       "      <td>159</td>\n",
       "      <td>True</td>\n",
       "      <td>1370.0</td>\n",
       "      <td>0.041154</td>\n",
       "      <td>0.087024</td>\n",
       "      <td>1.607399</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTC34</th>\n",
       "      <td>209</td>\n",
       "      <td>True</td>\n",
       "      <td>245.0</td>\n",
       "      <td>0.080341</td>\n",
       "      <td>0.363502</td>\n",
       "      <td>3.044086</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AJAP1</th>\n",
       "      <td>31</td>\n",
       "      <td>True</td>\n",
       "      <td>1922.0</td>\n",
       "      <td>0.006886</td>\n",
       "      <td>0.011432</td>\n",
       "      <td>1.421002</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MT-ND4L</th>\n",
       "      <td>650</td>\n",
       "      <td>True</td>\n",
       "      <td>1212.0</td>\n",
       "      <td>0.191671</td>\n",
       "      <td>0.559353</td>\n",
       "      <td>1.695637</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MT-ND4</th>\n",
       "      <td>1328</td>\n",
       "      <td>True</td>\n",
       "      <td>178.0</td>\n",
       "      <td>0.833087</td>\n",
       "      <td>9.742224</td>\n",
       "      <td>3.486984</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MT-ND5</th>\n",
       "      <td>886</td>\n",
       "      <td>True</td>\n",
       "      <td>443.0</td>\n",
       "      <td>0.332514</td>\n",
       "      <td>1.669344</td>\n",
       "      <td>2.430210</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MT-ND6</th>\n",
       "      <td>821</td>\n",
       "      <td>True</td>\n",
       "      <td>123.0</td>\n",
       "      <td>0.383178</td>\n",
       "      <td>3.357087</td>\n",
       "      <td>3.985056</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>MT-CYB</th>\n",
       "      <td>1295</td>\n",
       "      <td>True</td>\n",
       "      <td>414.0</td>\n",
       "      <td>0.622397</td>\n",
       "      <td>4.384615</td>\n",
       "      <td>2.487058</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>2000 rows × 6 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "          n_cells  highly_variable  highly_variable_rank     means  variances  \\\n",
       "TTLL10        112             True                 903.0  0.028857   0.069354   \n",
       "TNFRSF18       15             True                1604.0  0.002951   0.004911   \n",
       "CFAP74        159             True                1370.0  0.041154   0.087024   \n",
       "TTC34         209             True                 245.0  0.080341   0.363502   \n",
       "AJAP1          31             True                1922.0  0.006886   0.011432   \n",
       "...           ...              ...                   ...       ...        ...   \n",
       "MT-ND4L       650             True                1212.0  0.191671   0.559353   \n",
       "MT-ND4       1328             True                 178.0  0.833087   9.742224   \n",
       "MT-ND5        886             True                 443.0  0.332514   1.669344   \n",
       "MT-ND6        821             True                 123.0  0.383178   3.357087   \n",
       "MT-CYB       1295             True                 414.0  0.622397   4.384615   \n",
       "\n",
       "          variances_norm  \n",
       "TTLL10          1.901045  \n",
       "TNFRSF18        1.513808  \n",
       "CFAP74          1.607399  \n",
       "TTC34           3.044086  \n",
       "AJAP1           1.421002  \n",
       "...                  ...  \n",
       "MT-ND4L         1.695637  \n",
       "MT-ND4          3.486984  \n",
       "MT-ND5          2.430210  \n",
       "MT-ND6          3.985056  \n",
       "MT-CYB          2.487058  \n",
       "\n",
       "[2000 rows x 6 columns]"
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.var"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4a1140b7-d57d-4715-9d6d-80459156a746",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "### Doublet removal"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ad98ad10-0508-49f2-b1c7-2d6a309921a8",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "Here we `scvi-tools` model as [an interface](https://docs.scvi-tools.org/en/stable/api/reference/scvi.external.SOLO.html) to [solo](https://github.com/calico/solo) from <cite data-cite=\"Bernstein2020-am\">Bernstein et al. (2020)</cite>. `scvi` adds some unstructured data to interface with `torch`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "96f176e8-692e-481b-8f2b-9329ed051dd2",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:38.160957Z",
     "iopub.status.busy": "2022-09-28T19:34:38.160654Z",
     "iopub.status.idle": "2022-09-28T19:34:38.166286Z",
     "shell.execute_reply": "2022-09-28T19:34:38.165492Z",
     "shell.execute_reply.started": "2022-09-28T19:34:38.160936Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "OverloadedDict, wrapping:\n",
       "\tOrderedDict([('hvg', {'flavor': 'seurat_v3'})])\n",
       "With overloaded keys:\n",
       "\t['neighbors']."
      ]
     },
     "execution_count": 26,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.uns"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "id": "9c33eedb-dcce-41b2-8dbf-552a9d060d85",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:38.167506Z",
     "iopub.status.busy": "2022-09-28T19:34:38.167256Z",
     "iopub.status.idle": "2022-09-28T19:34:41.753737Z",
     "shell.execute_reply": "2022-09-28T19:34:41.753026Z",
     "shell.execute_reply.started": "2022-09-28T19:34:38.167487Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "scvi.model.SCVI.setup_anndata(adata)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "id": "b5f91d97-8c13-4b6a-9eae-4d2c3d694597",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:34:54.407914Z",
     "iopub.status.busy": "2022-09-28T19:34:54.407567Z",
     "iopub.status.idle": "2022-09-28T19:34:54.413453Z",
     "shell.execute_reply": "2022-09-28T19:34:54.412582Z",
     "shell.execute_reply.started": "2022-09-28T19:34:54.407889Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "OverloadedDict, wrapping:\n",
       "\tOrderedDict([('hvg', {'flavor': 'seurat_v3'}), ('_scvi_uuid', '290021be-0332-459c-9577-d34349c03ff4'), ('_scvi_manager_uuid', '49d2f232-173d-4da9-bff8-dd83ec7e62ad')])\n",
       "With overloaded keys:\n",
       "\t['neighbors']."
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.uns"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b57dad84-054a-4f47-8c9e-5aba41f4301a",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "Train the `scvi` model."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "id": "f55c2b56-302a-4508-84a9-9a914599d158",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:35:13.900556Z",
     "iopub.status.busy": "2022-09-28T19:35:13.900194Z",
     "iopub.status.idle": "2022-09-28T19:38:59.994321Z",
     "shell.execute_reply": "2022-09-28T19:38:59.993321Z",
     "shell.execute_reply.started": "2022-09-28T19:35:13.900529Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "GPU available: True (cuda), used: True\n",
      "TPU available: False, using: 0 TPU cores\n",
      "IPU available: False, using: 0 IPUs\n",
      "HPU available: False, using: 0 HPUs\n",
      "LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 400/400: 100% 400/400 [03:27<00:00,  2.12it/s, loss=323, v_num=1]"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "`Trainer.fit` stopped: `max_epochs=400` reached.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 400/400: 100% 400/400 [03:27<00:00,  1.92it/s, loss=323, v_num=1]\n"
     ]
    }
   ],
   "source": [
    "vae = scvi.model.SCVI(adata)\n",
    "vae.train()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fc589e02-14f1-47a2-904a-07f768f38c7e",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "After training the model `adata.obs` now contains `_scvi_batch` and `scvi_labels` annotations."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "id": "9495fc08-50ba-4f23-8d70-2f6ab1e2e68a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:45:58.902420Z",
     "iopub.status.busy": "2022-09-28T19:45:58.902043Z",
     "iopub.status.idle": "2022-09-28T19:45:58.909444Z",
     "shell.execute_reply": "2022-09-28T19:45:58.908217Z",
     "shell.execute_reply.started": "2022-09-28T19:45:58.902394Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "AnnData object with n_obs × n_vars = 6099 × 2000\n",
       "    obs: '_scvi_batch', '_scvi_labels'\n",
       "    var: 'n_cells', 'highly_variable', 'highly_variable_rank', 'means', 'variances', 'variances_norm'\n",
       "    uns: 'hvg', '_scvi_uuid', '_scvi_manager_uuid'"
      ]
     },
     "execution_count": 31,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "id": "ccefc9d6-2bf1-41d8-8448-cf20a7955ff1",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T19:46:28.902553Z",
     "iopub.status.busy": "2022-09-28T19:46:28.902183Z",
     "iopub.status.idle": "2022-09-28T19:46:28.915751Z",
     "shell.execute_reply": "2022-09-28T19:46:28.914837Z",
     "shell.execute_reply.started": "2022-09-28T19:46:28.902527Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>_scvi_batch</th>\n",
       "      <th>_scvi_labels</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>TAGGTACCATGGCCAC-1_1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ATTCACTGTAACAGGC-1_1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TAACTTCCAACCACGC-1_1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTGGGTACACGACAAG-1_1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AGGCCACAGAGTCACG-1_1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CGCCATTGTTTGCCGG-1_1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CACTGGGGTCTACGTA-1_1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CATACTTGTAGAGGAA-1_1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTTGGTTTCCACGGAC-1_1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ATGCATGAGTCATGAA-1_1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>6099 rows × 2 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                      _scvi_batch  _scvi_labels\n",
       "TAGGTACCATGGCCAC-1_1            0             0\n",
       "ATTCACTGTAACAGGC-1_1            0             0\n",
       "TAACTTCCAACCACGC-1_1            0             0\n",
       "TTGGGTACACGACAAG-1_1            0             0\n",
       "AGGCCACAGAGTCACG-1_1            0             0\n",
       "...                           ...           ...\n",
       "CGCCATTGTTTGCCGG-1_1            0             0\n",
       "CACTGGGGTCTACGTA-1_1            0             0\n",
       "CATACTTGTAGAGGAA-1_1            0             0\n",
       "TTTGGTTTCCACGGAC-1_1            0             0\n",
       "ATGCATGAGTCATGAA-1_1            0             0\n",
       "\n",
       "[6099 rows x 2 columns]"
      ]
     },
     "execution_count": 32,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.obs"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "27169b4c-dbf5-49cc-a518-1a917fe70640",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "Train the `solo` model."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "id": "ffb8c8ce-e950-4e11-91ce-31e36b28a0ca",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T20:28:02.947612Z",
     "iopub.status.busy": "2022-09-28T20:28:02.946981Z",
     "iopub.status.idle": "2022-09-28T20:29:47.207722Z",
     "shell.execute_reply": "2022-09-28T20:29:47.206863Z",
     "shell.execute_reply.started": "2022-09-28T20:28:02.947584Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\u001b[34mINFO    \u001b[0m Creating doublets, preparing SOLO model.                                            \n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/usr/lib/python3.10/site-packages/anndata/_core/anndata.py:1785: FutureWarning: X.dtype being converted to np.float32 from float64. In the next version of anndata (0.9) conversion will not be automatic. Pass dtype explicitly to avoid this warning. Pass `AnnData(X, dtype=X.dtype, ...)` to get the future behavour.\n",
      "  [AnnData(sparse.csr_matrix(a.shape), obs=a.obs) for a in all_adatas],\n",
      "GPU available: True (cuda), used: True\n",
      "TPU available: False, using: 0 TPU cores\n",
      "IPU available: False, using: 0 IPUs\n",
      "HPU available: False, using: 0 HPUs\n",
      "LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Epoch 207/400:  52% 207/400 [01:43<01:36,  2.01it/s, loss=0.299, v_num=1]\n",
      "Monitored metric validation_loss did not improve in the last 30 records. Best score: 0.295. Signaling Trainer to stop.\n"
     ]
    }
   ],
   "source": [
    "solo = scvi.external.SOLO.from_scvi_model(vae)\n",
    "solo.train()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "id": "a36004d0-374d-4d24-a3d2-ccca196e3f56",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T20:31:19.901208Z",
     "iopub.status.busy": "2022-09-28T20:31:19.900138Z",
     "iopub.status.idle": "2022-09-28T20:31:19.908112Z",
     "shell.execute_reply": "2022-09-28T20:31:19.907340Z",
     "shell.execute_reply.started": "2022-09-28T20:31:19.901152Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "scvi.external.solo._model.SOLO"
      ]
     },
     "execution_count": 35,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "type(solo)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "61263922-3a62-4f8c-bca5-06333de3df7e",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "We can now use the `solo` model to add a prediction annotation for doublet or singlet to our data."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "id": "61bab61f-e1b7-428b-9ad7-b64194baf955",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T20:31:57.901771Z",
     "iopub.status.busy": "2022-09-28T20:31:57.901121Z",
     "iopub.status.idle": "2022-09-28T20:31:58.065147Z",
     "shell.execute_reply": "2022-09-28T20:31:58.064202Z",
     "shell.execute_reply.started": "2022-09-28T20:31:57.901734Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>doublet</th>\n",
       "      <th>singlet</th>\n",
       "      <th>prediction</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>TAGGTACCATGGCCAC-1_1</th>\n",
       "      <td>1.729540</td>\n",
       "      <td>-0.992126</td>\n",
       "      <td>doublet</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ATTCACTGTAACAGGC-1_1</th>\n",
       "      <td>2.275840</td>\n",
       "      <td>-1.639090</td>\n",
       "      <td>doublet</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TAACTTCCAACCACGC-1_1</th>\n",
       "      <td>0.735813</td>\n",
       "      <td>-0.259502</td>\n",
       "      <td>doublet</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTGGGTACACGACAAG-1_1</th>\n",
       "      <td>1.618703</td>\n",
       "      <td>-0.680344</td>\n",
       "      <td>doublet</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AGGCCACAGAGTCACG-1_1</th>\n",
       "      <td>1.398426</td>\n",
       "      <td>-0.673206</td>\n",
       "      <td>doublet</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CGCCATTGTTTGCCGG-1_1</th>\n",
       "      <td>-0.691126</td>\n",
       "      <td>1.362337</td>\n",
       "      <td>singlet</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CACTGGGGTCTACGTA-1_1</th>\n",
       "      <td>-2.632991</td>\n",
       "      <td>2.468916</td>\n",
       "      <td>singlet</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CATACTTGTAGAGGAA-1_1</th>\n",
       "      <td>-2.506424</td>\n",
       "      <td>2.567346</td>\n",
       "      <td>singlet</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTTGGTTTCCACGGAC-1_1</th>\n",
       "      <td>-3.308819</td>\n",
       "      <td>2.476630</td>\n",
       "      <td>singlet</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ATGCATGAGTCATGAA-1_1</th>\n",
       "      <td>-2.357370</td>\n",
       "      <td>2.206591</td>\n",
       "      <td>singlet</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>6099 rows × 3 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                       doublet   singlet prediction\n",
       "TAGGTACCATGGCCAC-1_1  1.729540 -0.992126    doublet\n",
       "ATTCACTGTAACAGGC-1_1  2.275840 -1.639090    doublet\n",
       "TAACTTCCAACCACGC-1_1  0.735813 -0.259502    doublet\n",
       "TTGGGTACACGACAAG-1_1  1.618703 -0.680344    doublet\n",
       "AGGCCACAGAGTCACG-1_1  1.398426 -0.673206    doublet\n",
       "...                        ...       ...        ...\n",
       "CGCCATTGTTTGCCGG-1_1 -0.691126  1.362337    singlet\n",
       "CACTGGGGTCTACGTA-1_1 -2.632991  2.468916    singlet\n",
       "CATACTTGTAGAGGAA-1_1 -2.506424  2.567346    singlet\n",
       "TTTGGTTTCCACGGAC-1_1 -3.308819  2.476630    singlet\n",
       "ATGCATGAGTCATGAA-1_1 -2.357370  2.206591    singlet\n",
       "\n",
       "[6099 rows x 3 columns]"
      ]
     },
     "execution_count": 36,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = solo.predict()\n",
    "df[\"prediction\"] = solo.predict(soft=False)\n",
    "\n",
    "df.index = df.index.map(lambda x: x[:-2])\n",
    "\n",
    "df"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a6b55013-552d-4ee1-9d4f-0e248a6860fc",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "Counting the predicted doublets and singlets reveals about 20% doublets."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "id": "ed0b6743-456f-45c9-bc3b-7da7bb8b7c66",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T20:33:25.413361Z",
     "iopub.status.busy": "2022-09-28T20:33:25.412408Z",
     "iopub.status.idle": "2022-09-28T20:33:25.424245Z",
     "shell.execute_reply": "2022-09-28T20:33:25.423275Z",
     "shell.execute_reply.started": "2022-09-28T20:33:25.413323Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>doublet</th>\n",
       "      <th>singlet</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>prediction</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>doublet</th>\n",
       "      <td>1206</td>\n",
       "      <td>1206</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>singlet</th>\n",
       "      <td>4893</td>\n",
       "      <td>4893</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "            doublet  singlet\n",
       "prediction                  \n",
       "doublet        1206     1206\n",
       "singlet        4893     4893"
      ]
     },
     "execution_count": 37,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.groupby(\"prediction\").count()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c22b0aca-acbe-4205-96d4-8568452b7cba",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "We can assess the magnitude of the prediction by taking the difference between the doublet and singlet scores."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 38,
   "id": "dfa1490c-e914-4829-a492-448108453d5d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T20:35:53.901813Z",
     "iopub.status.busy": "2022-09-28T20:35:53.900857Z",
     "iopub.status.idle": "2022-09-28T20:35:53.914930Z",
     "shell.execute_reply": "2022-09-28T20:35:53.914067Z",
     "shell.execute_reply.started": "2022-09-28T20:35:53.901776Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>doublet</th>\n",
       "      <th>singlet</th>\n",
       "      <th>prediction</th>\n",
       "      <th>dif</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>TAGGTACCATGGCCAC-1_1</th>\n",
       "      <td>1.729540</td>\n",
       "      <td>-0.992126</td>\n",
       "      <td>doublet</td>\n",
       "      <td>2.721666</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ATTCACTGTAACAGGC-1_1</th>\n",
       "      <td>2.275840</td>\n",
       "      <td>-1.639090</td>\n",
       "      <td>doublet</td>\n",
       "      <td>3.914930</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TAACTTCCAACCACGC-1_1</th>\n",
       "      <td>0.735813</td>\n",
       "      <td>-0.259502</td>\n",
       "      <td>doublet</td>\n",
       "      <td>0.995315</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTGGGTACACGACAAG-1_1</th>\n",
       "      <td>1.618703</td>\n",
       "      <td>-0.680344</td>\n",
       "      <td>doublet</td>\n",
       "      <td>2.299047</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AGGCCACAGAGTCACG-1_1</th>\n",
       "      <td>1.398426</td>\n",
       "      <td>-0.673206</td>\n",
       "      <td>doublet</td>\n",
       "      <td>2.071632</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CGCCATTGTTTGCCGG-1_1</th>\n",
       "      <td>-0.691126</td>\n",
       "      <td>1.362337</td>\n",
       "      <td>singlet</td>\n",
       "      <td>-2.053463</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CACTGGGGTCTACGTA-1_1</th>\n",
       "      <td>-2.632991</td>\n",
       "      <td>2.468916</td>\n",
       "      <td>singlet</td>\n",
       "      <td>-5.101907</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CATACTTGTAGAGGAA-1_1</th>\n",
       "      <td>-2.506424</td>\n",
       "      <td>2.567346</td>\n",
       "      <td>singlet</td>\n",
       "      <td>-5.073770</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTTGGTTTCCACGGAC-1_1</th>\n",
       "      <td>-3.308819</td>\n",
       "      <td>2.476630</td>\n",
       "      <td>singlet</td>\n",
       "      <td>-5.785450</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ATGCATGAGTCATGAA-1_1</th>\n",
       "      <td>-2.357370</td>\n",
       "      <td>2.206591</td>\n",
       "      <td>singlet</td>\n",
       "      <td>-4.563961</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>6099 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                       doublet   singlet prediction       dif\n",
       "TAGGTACCATGGCCAC-1_1  1.729540 -0.992126    doublet  2.721666\n",
       "ATTCACTGTAACAGGC-1_1  2.275840 -1.639090    doublet  3.914930\n",
       "TAACTTCCAACCACGC-1_1  0.735813 -0.259502    doublet  0.995315\n",
       "TTGGGTACACGACAAG-1_1  1.618703 -0.680344    doublet  2.299047\n",
       "AGGCCACAGAGTCACG-1_1  1.398426 -0.673206    doublet  2.071632\n",
       "...                        ...       ...        ...       ...\n",
       "CGCCATTGTTTGCCGG-1_1 -0.691126  1.362337    singlet -2.053463\n",
       "CACTGGGGTCTACGTA-1_1 -2.632991  2.468916    singlet -5.101907\n",
       "CATACTTGTAGAGGAA-1_1 -2.506424  2.567346    singlet -5.073770\n",
       "TTTGGTTTCCACGGAC-1_1 -3.308819  2.476630    singlet -5.785450\n",
       "ATGCATGAGTCATGAA-1_1 -2.357370  2.206591    singlet -4.563961\n",
       "\n",
       "[6099 rows x 4 columns]"
      ]
     },
     "execution_count": 38,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df[\"dif\"] = df.doublet - df.singlet\n",
    "df"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a3654311-55c6-4c08-be45-f13d803ff5bf",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "Plotting the distribution of doublet-singlet score differences we see there are a large fraction that marginally favor doublet to singlet."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "59bc99fc-7c77-48c7-9911-5382accd4dd9",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-29T00:51:31.269525Z",
     "iopub.status.busy": "2022-09-29T00:51:31.268902Z",
     "iopub.status.idle": "2022-09-29T00:51:31.435425Z",
     "shell.execute_reply": "2022-09-29T00:51:31.434600Z",
     "shell.execute_reply.started": "2022-09-29T00:51:31.269493Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<AxesSubplot:xlabel='dif', ylabel='Count'>"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/svg+xml": [
       "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"no\"?>\n",
       "<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n",
       "  \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n",
       "<svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"419.305pt\" height=\"319.962pt\" viewBox=\"0 0 419.305 319.962\" xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">\n",
       " <metadata>\n",
       "  <rdf:RDF xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:cc=\"http://creativecommons.org/ns#\" xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\">\n",
       "   <cc:Work>\n",
       "    <dc:type rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\"/>\n",
       "    <dc:date>2022-09-29T00:51:31.402383</dc:date>\n",
       "    <dc:format>image/svg+xml</dc:format>\n",
       "    <dc:creator>\n",
       "     <cc:Agent>\n",
       "      <dc:title>Matplotlib v3.5.2, https://matplotlib.org/</dc:title>\n",
       "     </cc:Agent>\n",
       "    </dc:creator>\n",
       "   </cc:Work>\n",
       "  </rdf:RDF>\n",
       " </metadata>\n",
       " <defs>\n",
       "  <style type=\"text/css\">*{stroke-linejoin: round; stroke-linecap: butt}</style>\n",
       " </defs>\n",
       " <g id=\"figure_1\">\n",
       "  <g id=\"patch_1\">\n",
       "   <path d=\"M 0 319.962 \n",
       "L 419.305 319.962 \n",
       "L 419.305 0 \n",
       "L 0 0 \n",
       "z\n",
       "\" style=\"fill: #ffffff\"/>\n",
       "  </g>\n",
       "  <g id=\"axes_1\">\n",
       "   <g id=\"patch_2\">\n",
       "    <path d=\"M 54.985 273.312 \n",
       "L 412.105 273.312 \n",
       "L 412.105 7.2 \n",
       "L 54.985 7.2 \n",
       "z\n",
       "\" style=\"fill: #ffffff\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_3\">\n",
       "    <path d=\"M 71.217727 273.312 \n",
       "L 81.363182 273.312 \n",
       "L 81.363182 35.802514 \n",
       "L 71.217727 35.802514 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_4\">\n",
       "    <path d=\"M 81.363182 273.312 \n",
       "L 91.508636 273.312 \n",
       "L 91.508636 19.872 \n",
       "L 81.363182 19.872 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_5\">\n",
       "    <path d=\"M 91.508636 273.312 \n",
       "L 101.65409 273.312 \n",
       "L 101.65409 45.940114 \n",
       "L 91.508636 45.940114 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_6\">\n",
       "    <path d=\"M 101.65409 273.312 \n",
       "L 111.799545 273.312 \n",
       "L 111.799545 103.869257 \n",
       "L 101.65409 103.869257 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_7\">\n",
       "    <path d=\"M 111.799545 273.312 \n",
       "L 121.944999 273.312 \n",
       "L 121.944999 108.213943 \n",
       "L 111.799545 108.213943 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_8\">\n",
       "    <path d=\"M 121.944999 273.312 \n",
       "L 132.090453 273.312 \n",
       "L 132.090453 164.694857 \n",
       "L 121.944999 164.694857 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_9\">\n",
       "    <path d=\"M 132.090453 273.312 \n",
       "L 142.235908 273.312 \n",
       "L 142.235908 145.867886 \n",
       "L 132.090453 145.867886 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_10\">\n",
       "    <path d=\"M 142.235908 273.312 \n",
       "L 152.381362 273.312 \n",
       "L 152.381362 167.591314 \n",
       "L 142.235908 167.591314 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_11\">\n",
       "    <path d=\"M 152.381362 273.312 \n",
       "L 162.526816 273.312 \n",
       "L 162.526816 218.279314 \n",
       "L 152.381362 218.279314 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_12\">\n",
       "    <path d=\"M 162.526816 273.312 \n",
       "L 172.672271 273.312 \n",
       "L 172.672271 216.831086 \n",
       "L 162.526816 216.831086 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_13\">\n",
       "    <path d=\"M 172.672271 273.312 \n",
       "L 182.817732 273.312 \n",
       "L 182.817732 226.968686 \n",
       "L 172.672271 226.968686 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_14\">\n",
       "    <path d=\"M 182.817732 273.312 \n",
       "L 192.963186 273.312 \n",
       "L 192.963186 229.865143 \n",
       "L 182.817732 229.865143 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_15\">\n",
       "    <path d=\"M 192.963186 273.312 \n",
       "L 203.10864 273.312 \n",
       "L 203.10864 245.795657 \n",
       "L 192.963186 245.795657 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_16\">\n",
       "    <path d=\"M 203.10864 273.312 \n",
       "L 213.254095 273.312 \n",
       "L 213.254095 251.588571 \n",
       "L 203.10864 251.588571 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_17\">\n",
       "    <path d=\"M 213.254095 273.312 \n",
       "L 223.399549 273.312 \n",
       "L 223.399549 240.002743 \n",
       "L 213.254095 240.002743 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_18\">\n",
       "    <path d=\"M 223.399549 273.312 \n",
       "L 233.545003 273.312 \n",
       "L 233.545003 260.277943 \n",
       "L 223.399549 260.277943 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_19\">\n",
       "    <path d=\"M 233.545003 273.312 \n",
       "L 243.690458 273.312 \n",
       "L 243.690458 263.1744 \n",
       "L 233.545003 263.1744 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_20\">\n",
       "    <path d=\"M 243.690458 273.312 \n",
       "L 253.835912 273.312 \n",
       "L 253.835912 266.070857 \n",
       "L 243.690458 266.070857 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_21\">\n",
       "    <path d=\"M 253.835912 273.312 \n",
       "L 263.981366 273.312 \n",
       "L 263.981366 266.070857 \n",
       "L 253.835912 266.070857 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_22\">\n",
       "    <path d=\"M 263.981366 273.312 \n",
       "L 274.126821 273.312 \n",
       "L 274.126821 267.519086 \n",
       "L 263.981366 267.519086 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_23\">\n",
       "    <path d=\"M 274.126821 273.312 \n",
       "L 284.272275 273.312 \n",
       "L 284.272275 266.070857 \n",
       "L 274.126821 266.070857 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_24\">\n",
       "    <path d=\"M 284.272275 273.312 \n",
       "L 294.417729 273.312 \n",
       "L 294.417729 267.519086 \n",
       "L 284.272275 267.519086 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_25\">\n",
       "    <path d=\"M 294.417729 273.312 \n",
       "L 304.563184 273.312 \n",
       "L 304.563184 271.863771 \n",
       "L 294.417729 271.863771 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_26\">\n",
       "    <path d=\"M 304.563184 273.312 \n",
       "L 314.708638 273.312 \n",
       "L 314.708638 271.863771 \n",
       "L 304.563184 271.863771 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_27\">\n",
       "    <path d=\"M 314.708638 273.312 \n",
       "L 324.854092 273.312 \n",
       "L 324.854092 271.863771 \n",
       "L 314.708638 271.863771 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_28\">\n",
       "    <path d=\"M 324.854092 273.312 \n",
       "L 334.999547 273.312 \n",
       "L 334.999547 268.967314 \n",
       "L 324.854092 268.967314 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_29\">\n",
       "    <path d=\"M 334.999547 273.312 \n",
       "L 345.145001 273.312 \n",
       "L 345.145001 271.863771 \n",
       "L 334.999547 271.863771 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_30\">\n",
       "    <path d=\"M 345.145001 273.312 \n",
       "L 355.290455 273.312 \n",
       "L 355.290455 273.312 \n",
       "L 345.145001 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_31\">\n",
       "    <path d=\"M 355.290455 273.312 \n",
       "L 365.43591 273.312 \n",
       "L 365.43591 273.312 \n",
       "L 355.290455 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_32\">\n",
       "    <path d=\"M 365.43591 273.312 \n",
       "L 375.581364 273.312 \n",
       "L 375.581364 273.312 \n",
       "L 365.43591 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_33\">\n",
       "    <path d=\"M 375.581364 273.312 \n",
       "L 385.726818 273.312 \n",
       "L 385.726818 273.312 \n",
       "L 375.581364 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_34\">\n",
       "    <path d=\"M 385.726818 273.312 \n",
       "L 395.872273 273.312 \n",
       "L 395.872273 271.863771 \n",
       "L 385.726818 271.863771 \n",
       "z\n",
       "\" clip-path=\"url(#pa1a43926bb)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"matplotlib.axis_1\">\n",
       "    <g id=\"xtick_1\">\n",
       "     <g id=\"line2d_1\">\n",
       "      <defs>\n",
       "       <path id=\"ma82e77da8c\" d=\"M 0 0 \n",
       "L 0 3.5 \n",
       "\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </defs>\n",
       "      <g>\n",
       "       <use xlink:href=\"#ma82e77da8c\" x=\"71.075531\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_1\">\n",
       "      <!-- 0 -->\n",
       "      <g transform=\"translate(67.315531 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-30\" d=\"M 2758 2093 \n",
       "C 2758 2458 2752 3136 2490 3661 \n",
       "C 2227 4166 1805 4301 1504 4301 \n",
       "C 1069 4301 698 4045 506 3635 \n",
       "C 301 3206 243 2765 243 2093 \n",
       "C 243 1632 262 1069 493 576 \n",
       "C 755 32 1197 -102 1498 -102 \n",
       "C 1894 -102 2278 109 2496 550 \n",
       "C 2720 1011 2758 1517 2758 2093 \n",
       "z\n",
       "M 2272 2163 \n",
       "C 2272 1568 2272 288 1498 288 \n",
       "C 1011 288 864 845 819 1030 \n",
       "C 742 1350 730 1658 730 2163 \n",
       "C 730 2560 730 3008 851 3360 \n",
       "C 998 3770 1254 3910 1498 3910 \n",
       "C 1971 3910 2125 3437 2176 3270 \n",
       "C 2272 2931 2272 2534 2272 2163 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_2\">\n",
       "     <g id=\"line2d_2\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#ma82e77da8c\" x=\"125.16\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_2\">\n",
       "      <!-- 1 -->\n",
       "      <g transform=\"translate(121.4 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-31\" d=\"M 2573 0 \n",
       "L 2573 371 \n",
       "L 1818 371 \n",
       "L 1818 4301 \n",
       "L 1696 4301 \n",
       "C 1350 3942 947 3891 538 3878 \n",
       "L 538 3507 \n",
       "C 723 3514 1024 3526 1325 3661 \n",
       "L 1325 371 \n",
       "L 570 371 \n",
       "L 570 0 \n",
       "L 2573 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-31\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_3\">\n",
       "     <g id=\"line2d_3\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#ma82e77da8c\" x=\"179.244469\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_3\">\n",
       "      <!-- 2 -->\n",
       "      <g transform=\"translate(175.484469 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-32\" d=\"M 2701 0 \n",
       "L 2701 435 \n",
       "L 1613 435 \n",
       "C 1536 435 1459 429 1382 429 \n",
       "L 742 429 \n",
       "L 742 435 \n",
       "L 1651 1357 \n",
       "C 1830 1542 2099 1766 2285 1990 \n",
       "C 2464 2208 2701 2515 2701 2963 \n",
       "C 2701 3667 2227 4301 1421 4301 \n",
       "C 787 4301 422 3904 250 3283 \n",
       "L 499 2938 \n",
       "C 640 3520 838 3891 1338 3891 \n",
       "C 1888 3891 2195 3443 2195 2950 \n",
       "C 2195 2362 1747 1907 1408 1568 \n",
       "L 301 410 \n",
       "L 301 0 \n",
       "L 2701 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-32\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_4\">\n",
       "     <g id=\"line2d_4\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#ma82e77da8c\" x=\"233.328939\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_4\">\n",
       "      <!-- 3 -->\n",
       "      <g transform=\"translate(229.568939 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-33\" d=\"M 2752 1178 \n",
       "C 2752 1683 2400 2106 1920 2266 \n",
       "C 2304 2477 2586 2874 2586 3334 \n",
       "C 2586 3872 2093 4301 1491 4301 \n",
       "C 941 4301 512 3962 333 3597 \n",
       "C 378 3533 493 3347 550 3251 \n",
       "C 691 3629 1056 3910 1485 3910 \n",
       "C 1843 3910 2080 3674 2080 3334 \n",
       "C 2080 2982 1856 2598 1478 2509 \n",
       "C 1453 2509 1056 2470 1005 2464 \n",
       "L 1005 2074 \n",
       "L 1440 2074 \n",
       "C 2042 2074 2214 1549 2214 1184 \n",
       "C 2214 685 1933 294 1472 294 \n",
       "C 1114 294 608 474 320 947 \n",
       "C 275 723 275 710 250 557 \n",
       "C 550 115 1037 -102 1485 -102 \n",
       "C 2214 -102 2752 506 2752 1178 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-33\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_5\">\n",
       "     <g id=\"line2d_5\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#ma82e77da8c\" x=\"287.413408\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_5\">\n",
       "      <!-- 4 -->\n",
       "      <g transform=\"translate(283.653408 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-34\" d=\"M 2835 1094 \n",
       "L 2835 1485 \n",
       "L 2253 1485 \n",
       "L 2253 4198 \n",
       "L 1690 4198 \n",
       "L 166 1485 \n",
       "L 166 1094 \n",
       "L 1747 1094 \n",
       "L 1747 0 \n",
       "L 2253 0 \n",
       "L 2253 1094 \n",
       "L 2835 1094 \n",
       "z\n",
       "M 1766 1485 \n",
       "L 659 1485 \n",
       "C 1030 2138 1760 3456 1766 3904 \n",
       "L 1766 1485 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-34\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_6\">\n",
       "     <g id=\"line2d_6\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#ma82e77da8c\" x=\"341.497878\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_6\">\n",
       "      <!-- 5 -->\n",
       "      <g transform=\"translate(337.737878 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-35\" d=\"M 2701 1299 \n",
       "C 2701 2086 2182 2694 1562 2694 \n",
       "C 1338 2694 1120 2618 934 2464 \n",
       "L 934 3789 \n",
       "L 2502 3789 \n",
       "L 2502 4198 \n",
       "L 467 4198 \n",
       "L 467 1837 \n",
       "L 896 1837 \n",
       "C 1011 2106 1248 2304 1555 2304 \n",
       "C 1843 2304 2163 2048 2163 1312 \n",
       "C 2163 525 1709 294 1376 294 \n",
       "C 966 294 589 544 422 890 \n",
       "L 218 531 \n",
       "C 512 77 992 -102 1376 -102 \n",
       "C 2118 -102 2701 531 2701 1299 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-35\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_7\">\n",
       "     <g id=\"line2d_7\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#ma82e77da8c\" x=\"395.582347\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_7\">\n",
       "      <!-- 6 -->\n",
       "      <g transform=\"translate(391.822347 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-36\" d=\"M 2752 1421 \n",
       "C 2752 2214 2362 2918 1779 2918 \n",
       "C 1357 2918 992 2694 768 2413 \n",
       "C 832 3315 1254 3910 1862 3910 \n",
       "C 2029 3910 2246 3885 2496 3776 \n",
       "L 2496 4173 \n",
       "C 2227 4282 2035 4301 1856 4301 \n",
       "C 1024 4301 250 3430 250 2054 \n",
       "C 250 294 986 -102 1510 -102 \n",
       "C 1798 -102 2086 -13 2362 307 \n",
       "C 2643 646 2752 928 2752 1421 \n",
       "z\n",
       "M 2246 1421 \n",
       "C 2246 1171 2246 922 2099 666 \n",
       "C 1978 467 1818 294 1510 294 \n",
       "C 902 294 800 1146 774 1402 \n",
       "C 774 1453 774 1485 781 1581 \n",
       "C 781 2080 1069 2528 1536 2528 \n",
       "C 1837 2528 1990 2368 2106 2170 \n",
       "C 2240 1920 2246 1683 2246 1421 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-36\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"text_8\">\n",
       "     <!-- dif -->\n",
       "     <g transform=\"translate(225.5925 309.642)scale(0.16 -0.16)\">\n",
       "      <defs>\n",
       "       <path id=\"LMSans17-Regular-64\" d=\"M 2611 0 \n",
       "L 2611 4442 \n",
       "L 2138 4442 \n",
       "L 2138 2483 \n",
       "C 1939 2650 1613 2803 1254 2803 \n",
       "C 672 2803 211 2170 211 1376 \n",
       "C 211 582 666 -51 1235 -51 \n",
       "C 1677 -51 1971 186 2125 320 \n",
       "L 2125 0 \n",
       "L 2611 0 \n",
       "z\n",
       "M 2125 858 \n",
       "C 2125 768 2125 672 1926 499 \n",
       "C 1798 390 1645 339 1498 339 \n",
       "C 1152 339 698 595 698 1370 \n",
       "C 698 2176 1210 2413 1562 2413 \n",
       "C 1798 2413 1990 2298 2125 2106 \n",
       "L 2125 858 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-69\" d=\"M 947 0 \n",
       "L 947 2752 \n",
       "L 474 2752 \n",
       "L 474 0 \n",
       "L 947 0 \n",
       "z\n",
       "M 986 3610 \n",
       "L 986 4147 \n",
       "L 448 4147 \n",
       "L 448 3610 \n",
       "L 986 3610 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-66\" d=\"M 2080 4019 \n",
       "L 2080 4442 \n",
       "C 1933 4474 1754 4493 1613 4493 \n",
       "C 1018 4493 602 4006 602 3373 \n",
       "L 602 2752 \n",
       "L 160 2752 \n",
       "L 160 2381 \n",
       "L 602 2381 \n",
       "L 602 0 \n",
       "L 1075 0 \n",
       "L 1075 2381 \n",
       "L 1722 2381 \n",
       "L 1722 2752 \n",
       "L 1062 2752 \n",
       "L 1062 3571 \n",
       "C 1062 4026 1408 4102 1606 4102 \n",
       "C 1670 4102 1850 4102 2080 4019 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "      </defs>\n",
       "      <use xlink:href=\"#LMSans17-Regular-64\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-69\" x=\"48.399994\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-66\" x=\"70.699982\"/>\n",
       "     </g>\n",
       "    </g>\n",
       "   </g>\n",
       "   <g id=\"matplotlib.axis_2\">\n",
       "    <g id=\"ytick_1\">\n",
       "     <g id=\"line2d_8\">\n",
       "      <defs>\n",
       "       <path id=\"m2b4154f9f0\" d=\"M 0 0 \n",
       "L -3.5 0 \n",
       "\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </defs>\n",
       "      <g>\n",
       "       <use xlink:href=\"#m2b4154f9f0\" x=\"54.985\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_9\">\n",
       "      <!-- 0 -->\n",
       "      <g transform=\"translate(40.465 278.8645)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_2\">\n",
       "     <g id=\"line2d_9\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m2b4154f9f0\" x=\"54.985\" y=\"237.106286\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_10\">\n",
       "      <!-- 25 -->\n",
       "      <g transform=\"translate(32.945 242.658786)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-32\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-35\" x=\"46.999985\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_3\">\n",
       "     <g id=\"line2d_10\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m2b4154f9f0\" x=\"54.985\" y=\"200.900571\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_11\">\n",
       "      <!-- 50 -->\n",
       "      <g transform=\"translate(32.945 206.453071)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-35\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_4\">\n",
       "     <g id=\"line2d_11\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m2b4154f9f0\" x=\"54.985\" y=\"164.694857\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_12\">\n",
       "      <!-- 75 -->\n",
       "      <g transform=\"translate(32.945 170.247357)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-37\" d=\"M 2752 3782 \n",
       "L 2752 4198 \n",
       "L 250 4198 \n",
       "L 250 3763 \n",
       "L 1389 3763 \n",
       "C 1466 3763 1542 3770 1619 3770 \n",
       "L 2355 3770 \n",
       "C 1440 2701 915 1350 915 -51 \n",
       "L 1427 -51 \n",
       "C 1427 1306 1875 2682 2752 3782 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-37\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-35\" x=\"46.999985\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_5\">\n",
       "     <g id=\"line2d_12\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m2b4154f9f0\" x=\"54.985\" y=\"128.489143\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_13\">\n",
       "      <!-- 100 -->\n",
       "      <g transform=\"translate(25.425 134.041643)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-31\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_6\">\n",
       "     <g id=\"line2d_13\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m2b4154f9f0\" x=\"54.985\" y=\"92.283429\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_14\">\n",
       "      <!-- 125 -->\n",
       "      <g transform=\"translate(25.425 97.835929)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-31\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-32\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-35\" x=\"93.999969\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_7\">\n",
       "     <g id=\"line2d_14\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m2b4154f9f0\" x=\"54.985\" y=\"56.077714\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_15\">\n",
       "      <!-- 150 -->\n",
       "      <g transform=\"translate(25.425 61.630214)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-31\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-35\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_8\">\n",
       "     <g id=\"line2d_15\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m2b4154f9f0\" x=\"54.985\" y=\"19.872\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_16\">\n",
       "      <!-- 175 -->\n",
       "      <g transform=\"translate(25.425 25.4245)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-31\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-37\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-35\" x=\"93.999969\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"text_17\">\n",
       "     <!-- Count -->\n",
       "     <g transform=\"translate(18.305 159.2885)rotate(-90)scale(0.16 -0.16)\">\n",
       "      <defs>\n",
       "       <path id=\"LMSans17-Regular-43\" d=\"M 3501 301 \n",
       "L 3462 736 \n",
       "C 3290 614 3123 493 2918 429 \n",
       "C 2720 365 2515 358 2310 358 \n",
       "C 1920 358 1568 582 1338 896 \n",
       "C 1050 1274 922 1734 922 2195 \n",
       "C 922 2662 1050 3130 1338 3501 \n",
       "C 1568 3808 1920 4038 2310 4038 \n",
       "C 2496 4038 2675 4019 2848 3962 \n",
       "C 3027 3910 3187 3814 3347 3718 \n",
       "L 3437 4230 \n",
       "C 3258 4301 3072 4358 2880 4397 \n",
       "C 2694 4435 2502 4448 2310 4448 \n",
       "C 1786 4448 1299 4192 954 3789 \n",
       "C 576 3347 390 2778 390 2195 \n",
       "C 390 1619 576 1050 954 608 \n",
       "C 1299 205 1786 -51 2310 -51 \n",
       "C 2522 -51 2733 -45 2938 13 \n",
       "C 3142 77 3322 186 3501 301 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-6f\" d=\"M 2829 1370 \n",
       "C 2829 2189 2221 2829 1504 2829 \n",
       "C 768 2829 173 2170 173 1370 \n",
       "C 173 557 787 -51 1498 -51 \n",
       "C 2227 -51 2829 576 2829 1370 \n",
       "z\n",
       "M 2342 1421 \n",
       "C 2342 698 1926 346 1498 346 \n",
       "C 1050 346 659 723 659 1421 \n",
       "C 659 2163 1114 2432 1498 2432 \n",
       "C 1914 2432 2342 2138 2342 1421 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-75\" d=\"M 2618 0 \n",
       "L 2618 2752 \n",
       "L 2131 2752 \n",
       "L 2131 986 \n",
       "C 2131 512 1786 320 1421 320 \n",
       "C 998 320 960 461 960 723 \n",
       "L 960 2752 \n",
       "L 474 2752 \n",
       "L 474 691 \n",
       "C 474 192 646 -51 1088 -51 \n",
       "C 1306 -51 1798 0 2144 320 \n",
       "L 2144 0 \n",
       "L 2618 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-6e\" d=\"M 2618 0 \n",
       "L 2618 1869 \n",
       "C 2618 2272 2522 2803 1798 2803 \n",
       "C 1389 2803 1120 2592 941 2374 \n",
       "L 941 2771 \n",
       "L 474 2771 \n",
       "L 474 0 \n",
       "L 960 0 \n",
       "L 960 1549 \n",
       "C 960 1952 1114 2413 1549 2413 \n",
       "C 2112 2413 2131 2035 2131 1818 \n",
       "L 2131 0 \n",
       "L 2618 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-74\" d=\"M 2003 186 \n",
       "L 1901 563 \n",
       "C 1747 429 1562 352 1363 352 \n",
       "C 1082 352 1069 710 1069 870 \n",
       "L 1069 2381 \n",
       "L 1901 2381 \n",
       "L 1901 2752 \n",
       "L 1069 2752 \n",
       "L 1069 3539 \n",
       "L 614 3539 \n",
       "L 614 2752 \n",
       "L 109 2752 \n",
       "L 109 2381 \n",
       "L 602 2381 \n",
       "L 602 762 \n",
       "C 602 397 685 -51 1107 -51 \n",
       "C 1427 -51 1722 38 2003 186 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "      </defs>\n",
       "      <use xlink:href=\"#LMSans17-Regular-43\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-6f\" x=\"60.099991\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-75\" x=\"107.099976\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-6e\" x=\"155.499969\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-74\" x=\"203.899963\"/>\n",
       "     </g>\n",
       "    </g>\n",
       "   </g>\n",
       "   <g id=\"patch_35\">\n",
       "    <path d=\"M 54.985 273.312 \n",
       "L 54.985 7.2 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_36\">\n",
       "    <path d=\"M 412.105 273.312 \n",
       "L 412.105 7.2 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_37\">\n",
       "    <path d=\"M 54.985 273.312 \n",
       "L 412.105 273.312 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_38\">\n",
       "    <path d=\"M 54.985 7.2 \n",
       "L 412.105 7.2 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "  </g>\n",
       " </g>\n",
       " <defs>\n",
       "  <clipPath id=\"pa1a43926bb\">\n",
       "   <rect x=\"54.985\" y=\"7.2\" width=\"357.12\" height=\"266.112\"/>\n",
       "  </clipPath>\n",
       " </defs>\n",
       "</svg>\n"
      ],
      "text/plain": [
       "<Figure size 640x480 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "sns.histplot(df[df.prediction == \"doublet\"], x=\"dif\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "82a49033-e8f4-451a-a2e4-86d8c958f41a",
   "metadata": {},
   "source": [
    "Since we would like to avoid unnecessarily discarding barcodes, we will arbitrarily retain those with a score from zero to one (however this is not intended to be principled)."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 42,
   "id": "23283d36-eff0-4495-9c7e-97d4f41e4b95",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T20:52:35.976260Z",
     "iopub.status.busy": "2022-09-28T20:52:35.975515Z",
     "iopub.status.idle": "2022-09-28T20:52:35.990714Z",
     "shell.execute_reply": "2022-09-28T20:52:35.989891Z",
     "shell.execute_reply.started": "2022-09-28T20:52:35.976225Z"
    }
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>doublet</th>\n",
       "      <th>singlet</th>\n",
       "      <th>prediction</th>\n",
       "      <th>dif</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>TAGGTACCATGGCCAC-1_1</th>\n",
       "      <td>1.729540</td>\n",
       "      <td>-0.992126</td>\n",
       "      <td>doublet</td>\n",
       "      <td>2.721666</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ATTCACTGTAACAGGC-1_1</th>\n",
       "      <td>2.275840</td>\n",
       "      <td>-1.639090</td>\n",
       "      <td>doublet</td>\n",
       "      <td>3.914930</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTGGGTACACGACAAG-1_1</th>\n",
       "      <td>1.618703</td>\n",
       "      <td>-0.680344</td>\n",
       "      <td>doublet</td>\n",
       "      <td>2.299047</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AGGCCACAGAGTCACG-1_1</th>\n",
       "      <td>1.398426</td>\n",
       "      <td>-0.673206</td>\n",
       "      <td>doublet</td>\n",
       "      <td>2.071632</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CACTGAAGTCGAAGCA-1_1</th>\n",
       "      <td>1.305717</td>\n",
       "      <td>-0.544905</td>\n",
       "      <td>doublet</td>\n",
       "      <td>1.850623</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CAATACGCAATGTGGG-1_1</th>\n",
       "      <td>0.471522</td>\n",
       "      <td>-0.923330</td>\n",
       "      <td>doublet</td>\n",
       "      <td>1.394853</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>GGGTATTTCAGCGCAC-1_1</th>\n",
       "      <td>1.101736</td>\n",
       "      <td>-0.658175</td>\n",
       "      <td>doublet</td>\n",
       "      <td>1.759911</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTGCTGCAGTGCGACA-1_1</th>\n",
       "      <td>0.720216</td>\n",
       "      <td>-0.624341</td>\n",
       "      <td>doublet</td>\n",
       "      <td>1.344557</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CATCCCAAGACGCCAA-1_1</th>\n",
       "      <td>0.937599</td>\n",
       "      <td>-0.486121</td>\n",
       "      <td>doublet</td>\n",
       "      <td>1.423720</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CACTGTCAGGGACAGG-1_1</th>\n",
       "      <td>1.190305</td>\n",
       "      <td>-0.678417</td>\n",
       "      <td>doublet</td>\n",
       "      <td>1.868721</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>451 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                       doublet   singlet prediction       dif\n",
       "TAGGTACCATGGCCAC-1_1  1.729540 -0.992126    doublet  2.721666\n",
       "ATTCACTGTAACAGGC-1_1  2.275840 -1.639090    doublet  3.914930\n",
       "TTGGGTACACGACAAG-1_1  1.618703 -0.680344    doublet  2.299047\n",
       "AGGCCACAGAGTCACG-1_1  1.398426 -0.673206    doublet  2.071632\n",
       "CACTGAAGTCGAAGCA-1_1  1.305717 -0.544905    doublet  1.850623\n",
       "...                        ...       ...        ...       ...\n",
       "CAATACGCAATGTGGG-1_1  0.471522 -0.923330    doublet  1.394853\n",
       "GGGTATTTCAGCGCAC-1_1  1.101736 -0.658175    doublet  1.759911\n",
       "TTGCTGCAGTGCGACA-1_1  0.720216 -0.624341    doublet  1.344557\n",
       "CATCCCAAGACGCCAA-1_1  0.937599 -0.486121    doublet  1.423720\n",
       "CACTGTCAGGGACAGG-1_1  1.190305 -0.678417    doublet  1.868721\n",
       "\n",
       "[451 rows x 4 columns]"
      ]
     },
     "execution_count": 42,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "doublets = df[(df.prediction == 'doublet') & (df.dif > 1)]\n",
    "doublets"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "02570549-6bcb-46da-bcab-84ad14e71e6b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-29T00:51:14.279483Z",
     "iopub.status.busy": "2022-09-29T00:51:14.278798Z",
     "iopub.status.idle": "2022-09-29T00:51:14.908770Z",
     "shell.execute_reply": "2022-09-29T00:51:14.908079Z",
     "shell.execute_reply.started": "2022-09-29T00:51:14.279454Z"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<AxesSubplot:xlabel='dif', ylabel='Count'>"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/svg+xml": [
       "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"no\"?>\n",
       "<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\n",
       "  \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n",
       "<svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"419.305pt\" height=\"319.962pt\" viewBox=\"0 0 419.305 319.962\" xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">\n",
       " <metadata>\n",
       "  <rdf:RDF xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:cc=\"http://creativecommons.org/ns#\" xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\">\n",
       "   <cc:Work>\n",
       "    <dc:type rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\"/>\n",
       "    <dc:date>2022-09-29T00:51:14.880264</dc:date>\n",
       "    <dc:format>image/svg+xml</dc:format>\n",
       "    <dc:creator>\n",
       "     <cc:Agent>\n",
       "      <dc:title>Matplotlib v3.5.2, https://matplotlib.org/</dc:title>\n",
       "     </cc:Agent>\n",
       "    </dc:creator>\n",
       "   </cc:Work>\n",
       "  </rdf:RDF>\n",
       " </metadata>\n",
       " <defs>\n",
       "  <style type=\"text/css\">*{stroke-linejoin: round; stroke-linecap: butt}</style>\n",
       " </defs>\n",
       " <g id=\"figure_1\">\n",
       "  <g id=\"patch_1\">\n",
       "   <path d=\"M 0 319.962 \n",
       "L 419.305 319.962 \n",
       "L 419.305 0 \n",
       "L 0 0 \n",
       "z\n",
       "\" style=\"fill: #ffffff\"/>\n",
       "  </g>\n",
       "  <g id=\"axes_1\">\n",
       "   <g id=\"patch_2\">\n",
       "    <path d=\"M 54.985 273.312 \n",
       "L 412.105 273.312 \n",
       "L 412.105 7.2 \n",
       "L 54.985 7.2 \n",
       "z\n",
       "\" style=\"fill: #ffffff\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_3\">\n",
       "    <path d=\"M 71.217727 273.312 \n",
       "L 86.677464 273.312 \n",
       "L 86.677464 19.872 \n",
       "L 71.217727 19.872 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_4\">\n",
       "    <path d=\"M 86.677464 273.312 \n",
       "L 102.137208 273.312 \n",
       "L 102.137208 41.595429 \n",
       "L 86.677464 41.595429 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_5\">\n",
       "    <path d=\"M 102.137208 273.312 \n",
       "L 117.596945 273.312 \n",
       "L 117.596945 147.798857 \n",
       "L 102.137208 147.798857 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_6\">\n",
       "    <path d=\"M 117.596945 273.312 \n",
       "L 133.056689 273.312 \n",
       "L 133.056689 169.522286 \n",
       "L 117.596945 169.522286 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_7\">\n",
       "    <path d=\"M 133.056689 273.312 \n",
       "L 148.516426 273.312 \n",
       "L 148.516426 179.177143 \n",
       "L 133.056689 179.177143 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_8\">\n",
       "    <path d=\"M 148.516426 273.312 \n",
       "L 163.976162 273.312 \n",
       "L 163.976162 198.486857 \n",
       "L 148.516426 198.486857 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_9\">\n",
       "    <path d=\"M 163.976162 273.312 \n",
       "L 179.435914 273.312 \n",
       "L 179.435914 229.865143 \n",
       "L 163.976162 229.865143 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_10\">\n",
       "    <path d=\"M 179.435914 273.312 \n",
       "L 194.895651 273.312 \n",
       "L 194.895651 210.555429 \n",
       "L 179.435914 210.555429 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_11\">\n",
       "    <path d=\"M 194.895651 273.312 \n",
       "L 210.355387 273.312 \n",
       "L 210.355387 249.174857 \n",
       "L 194.895651 249.174857 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_12\">\n",
       "    <path d=\"M 210.355387 273.312 \n",
       "L 225.815124 273.312 \n",
       "L 225.815124 261.243429 \n",
       "L 210.355387 261.243429 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_13\">\n",
       "    <path d=\"M 225.815124 273.312 \n",
       "L 241.274876 273.312 \n",
       "L 241.274876 256.416 \n",
       "L 225.815124 256.416 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_14\">\n",
       "    <path d=\"M 241.274876 273.312 \n",
       "L 256.734613 273.312 \n",
       "L 256.734613 261.243429 \n",
       "L 241.274876 261.243429 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_15\">\n",
       "    <path d=\"M 256.734613 273.312 \n",
       "L 272.194349 273.312 \n",
       "L 272.194349 258.829714 \n",
       "L 256.734613 258.829714 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_16\">\n",
       "    <path d=\"M 272.194349 273.312 \n",
       "L 287.654086 273.312 \n",
       "L 287.654086 270.898286 \n",
       "L 272.194349 270.898286 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_17\">\n",
       "    <path d=\"M 287.654086 273.312 \n",
       "L 303.113822 273.312 \n",
       "L 303.113822 270.898286 \n",
       "L 287.654086 270.898286 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_18\">\n",
       "    <path d=\"M 303.113822 273.312 \n",
       "L 318.573559 273.312 \n",
       "L 318.573559 266.070857 \n",
       "L 303.113822 266.070857 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_19\">\n",
       "    <path d=\"M 318.573559 273.312 \n",
       "L 334.033326 273.312 \n",
       "L 334.033326 268.484571 \n",
       "L 318.573559 268.484571 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_20\">\n",
       "    <path d=\"M 334.033326 273.312 \n",
       "L 349.493063 273.312 \n",
       "L 349.493063 273.312 \n",
       "L 334.033326 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_21\">\n",
       "    <path d=\"M 349.493063 273.312 \n",
       "L 364.9528 273.312 \n",
       "L 364.9528 273.312 \n",
       "L 349.493063 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_22\">\n",
       "    <path d=\"M 364.9528 273.312 \n",
       "L 380.412536 273.312 \n",
       "L 380.412536 273.312 \n",
       "L 364.9528 273.312 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_23\">\n",
       "    <path d=\"M 380.412536 273.312 \n",
       "L 395.872273 273.312 \n",
       "L 395.872273 270.898286 \n",
       "L 380.412536 270.898286 \n",
       "z\n",
       "\" clip-path=\"url(#p93c9aadc5e)\" style=\"fill: #1f77b4; fill-opacity: 0.75; stroke: #000000; stroke-linejoin: miter\"/>\n",
       "   </g>\n",
       "   <g id=\"matplotlib.axis_1\">\n",
       "    <g id=\"xtick_1\">\n",
       "     <g id=\"line2d_1\">\n",
       "      <defs>\n",
       "       <path id=\"meee619edc1\" d=\"M 0 0 \n",
       "L 0 3.5 \n",
       "\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </defs>\n",
       "      <g>\n",
       "       <use xlink:href=\"#meee619edc1\" x=\"70.977809\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_1\">\n",
       "      <!-- 1 -->\n",
       "      <g transform=\"translate(67.217809 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-31\" d=\"M 2573 0 \n",
       "L 2573 371 \n",
       "L 1818 371 \n",
       "L 1818 4301 \n",
       "L 1696 4301 \n",
       "C 1350 3942 947 3891 538 3878 \n",
       "L 538 3507 \n",
       "C 723 3514 1024 3526 1325 3661 \n",
       "L 1325 371 \n",
       "L 570 371 \n",
       "L 570 0 \n",
       "L 2573 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-31\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_2\">\n",
       "     <g id=\"line2d_2\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#meee619edc1\" x=\"135.887111\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_2\">\n",
       "      <!-- 2 -->\n",
       "      <g transform=\"translate(132.127111 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-32\" d=\"M 2701 0 \n",
       "L 2701 435 \n",
       "L 1613 435 \n",
       "C 1536 435 1459 429 1382 429 \n",
       "L 742 429 \n",
       "L 742 435 \n",
       "L 1651 1357 \n",
       "C 1830 1542 2099 1766 2285 1990 \n",
       "C 2464 2208 2701 2515 2701 2963 \n",
       "C 2701 3667 2227 4301 1421 4301 \n",
       "C 787 4301 422 3904 250 3283 \n",
       "L 499 2938 \n",
       "C 640 3520 838 3891 1338 3891 \n",
       "C 1888 3891 2195 3443 2195 2950 \n",
       "C 2195 2362 1747 1907 1408 1568 \n",
       "L 301 410 \n",
       "L 301 0 \n",
       "L 2701 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-32\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_3\">\n",
       "     <g id=\"line2d_3\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#meee619edc1\" x=\"200.796413\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_3\">\n",
       "      <!-- 3 -->\n",
       "      <g transform=\"translate(197.036413 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-33\" d=\"M 2752 1178 \n",
       "C 2752 1683 2400 2106 1920 2266 \n",
       "C 2304 2477 2586 2874 2586 3334 \n",
       "C 2586 3872 2093 4301 1491 4301 \n",
       "C 941 4301 512 3962 333 3597 \n",
       "C 378 3533 493 3347 550 3251 \n",
       "C 691 3629 1056 3910 1485 3910 \n",
       "C 1843 3910 2080 3674 2080 3334 \n",
       "C 2080 2982 1856 2598 1478 2509 \n",
       "C 1453 2509 1056 2470 1005 2464 \n",
       "L 1005 2074 \n",
       "L 1440 2074 \n",
       "C 2042 2074 2214 1549 2214 1184 \n",
       "C 2214 685 1933 294 1472 294 \n",
       "C 1114 294 608 474 320 947 \n",
       "C 275 723 275 710 250 557 \n",
       "C 550 115 1037 -102 1485 -102 \n",
       "C 2214 -102 2752 506 2752 1178 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-33\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_4\">\n",
       "     <g id=\"line2d_4\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#meee619edc1\" x=\"265.705716\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_4\">\n",
       "      <!-- 4 -->\n",
       "      <g transform=\"translate(261.945716 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-34\" d=\"M 2835 1094 \n",
       "L 2835 1485 \n",
       "L 2253 1485 \n",
       "L 2253 4198 \n",
       "L 1690 4198 \n",
       "L 166 1485 \n",
       "L 166 1094 \n",
       "L 1747 1094 \n",
       "L 1747 0 \n",
       "L 2253 0 \n",
       "L 2253 1094 \n",
       "L 2835 1094 \n",
       "z\n",
       "M 1766 1485 \n",
       "L 659 1485 \n",
       "C 1030 2138 1760 3456 1766 3904 \n",
       "L 1766 1485 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-34\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_5\">\n",
       "     <g id=\"line2d_5\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#meee619edc1\" x=\"330.615018\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_5\">\n",
       "      <!-- 5 -->\n",
       "      <g transform=\"translate(326.855018 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-35\" d=\"M 2701 1299 \n",
       "C 2701 2086 2182 2694 1562 2694 \n",
       "C 1338 2694 1120 2618 934 2464 \n",
       "L 934 3789 \n",
       "L 2502 3789 \n",
       "L 2502 4198 \n",
       "L 467 4198 \n",
       "L 467 1837 \n",
       "L 896 1837 \n",
       "C 1011 2106 1248 2304 1555 2304 \n",
       "C 1843 2304 2163 2048 2163 1312 \n",
       "C 2163 525 1709 294 1376 294 \n",
       "C 966 294 589 544 422 890 \n",
       "L 218 531 \n",
       "C 512 77 992 -102 1376 -102 \n",
       "C 2118 -102 2701 531 2701 1299 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-35\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"xtick_6\">\n",
       "     <g id=\"line2d_6\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#meee619edc1\" x=\"395.52432\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_6\">\n",
       "      <!-- 6 -->\n",
       "      <g transform=\"translate(391.76432 291.417)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-36\" d=\"M 2752 1421 \n",
       "C 2752 2214 2362 2918 1779 2918 \n",
       "C 1357 2918 992 2694 768 2413 \n",
       "C 832 3315 1254 3910 1862 3910 \n",
       "C 2029 3910 2246 3885 2496 3776 \n",
       "L 2496 4173 \n",
       "C 2227 4282 2035 4301 1856 4301 \n",
       "C 1024 4301 250 3430 250 2054 \n",
       "C 250 294 986 -102 1510 -102 \n",
       "C 1798 -102 2086 -13 2362 307 \n",
       "C 2643 646 2752 928 2752 1421 \n",
       "z\n",
       "M 2246 1421 \n",
       "C 2246 1171 2246 922 2099 666 \n",
       "C 1978 467 1818 294 1510 294 \n",
       "C 902 294 800 1146 774 1402 \n",
       "C 774 1453 774 1485 781 1581 \n",
       "C 781 2080 1069 2528 1536 2528 \n",
       "C 1837 2528 1990 2368 2106 2170 \n",
       "C 2240 1920 2246 1683 2246 1421 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-36\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"text_7\">\n",
       "     <!-- dif -->\n",
       "     <g transform=\"translate(225.5925 309.642)scale(0.16 -0.16)\">\n",
       "      <defs>\n",
       "       <path id=\"LMSans17-Regular-64\" d=\"M 2611 0 \n",
       "L 2611 4442 \n",
       "L 2138 4442 \n",
       "L 2138 2483 \n",
       "C 1939 2650 1613 2803 1254 2803 \n",
       "C 672 2803 211 2170 211 1376 \n",
       "C 211 582 666 -51 1235 -51 \n",
       "C 1677 -51 1971 186 2125 320 \n",
       "L 2125 0 \n",
       "L 2611 0 \n",
       "z\n",
       "M 2125 858 \n",
       "C 2125 768 2125 672 1926 499 \n",
       "C 1798 390 1645 339 1498 339 \n",
       "C 1152 339 698 595 698 1370 \n",
       "C 698 2176 1210 2413 1562 2413 \n",
       "C 1798 2413 1990 2298 2125 2106 \n",
       "L 2125 858 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-69\" d=\"M 947 0 \n",
       "L 947 2752 \n",
       "L 474 2752 \n",
       "L 474 0 \n",
       "L 947 0 \n",
       "z\n",
       "M 986 3610 \n",
       "L 986 4147 \n",
       "L 448 4147 \n",
       "L 448 3610 \n",
       "L 986 3610 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-66\" d=\"M 2080 4019 \n",
       "L 2080 4442 \n",
       "C 1933 4474 1754 4493 1613 4493 \n",
       "C 1018 4493 602 4006 602 3373 \n",
       "L 602 2752 \n",
       "L 160 2752 \n",
       "L 160 2381 \n",
       "L 602 2381 \n",
       "L 602 0 \n",
       "L 1075 0 \n",
       "L 1075 2381 \n",
       "L 1722 2381 \n",
       "L 1722 2752 \n",
       "L 1062 2752 \n",
       "L 1062 3571 \n",
       "C 1062 4026 1408 4102 1606 4102 \n",
       "C 1670 4102 1850 4102 2080 4019 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "      </defs>\n",
       "      <use xlink:href=\"#LMSans17-Regular-64\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-69\" x=\"48.399994\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-66\" x=\"70.699982\"/>\n",
       "     </g>\n",
       "    </g>\n",
       "   </g>\n",
       "   <g id=\"matplotlib.axis_2\">\n",
       "    <g id=\"ytick_1\">\n",
       "     <g id=\"line2d_7\">\n",
       "      <defs>\n",
       "       <path id=\"m0e9cc4c867\" d=\"M 0 0 \n",
       "L -3.5 0 \n",
       "\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </defs>\n",
       "      <g>\n",
       "       <use xlink:href=\"#m0e9cc4c867\" x=\"54.985\" y=\"273.312\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_8\">\n",
       "      <!-- 0 -->\n",
       "      <g transform=\"translate(40.465 278.8645)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-30\" d=\"M 2758 2093 \n",
       "C 2758 2458 2752 3136 2490 3661 \n",
       "C 2227 4166 1805 4301 1504 4301 \n",
       "C 1069 4301 698 4045 506 3635 \n",
       "C 301 3206 243 2765 243 2093 \n",
       "C 243 1632 262 1069 493 576 \n",
       "C 755 32 1197 -102 1498 -102 \n",
       "C 1894 -102 2278 109 2496 550 \n",
       "C 2720 1011 2758 1517 2758 2093 \n",
       "z\n",
       "M 2272 2163 \n",
       "C 2272 1568 2272 288 1498 288 \n",
       "C 1011 288 864 845 819 1030 \n",
       "C 742 1350 730 1658 730 2163 \n",
       "C 730 2560 730 3008 851 3360 \n",
       "C 998 3770 1254 3910 1498 3910 \n",
       "C 1971 3910 2125 3437 2176 3270 \n",
       "C 2272 2931 2272 2534 2272 2163 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_2\">\n",
       "     <g id=\"line2d_8\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m0e9cc4c867\" x=\"54.985\" y=\"225.037714\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_9\">\n",
       "      <!-- 20 -->\n",
       "      <g transform=\"translate(32.945 230.590214)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-32\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_3\">\n",
       "     <g id=\"line2d_9\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m0e9cc4c867\" x=\"54.985\" y=\"176.763429\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_10\">\n",
       "      <!-- 40 -->\n",
       "      <g transform=\"translate(32.945 182.315929)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-34\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_4\">\n",
       "     <g id=\"line2d_10\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m0e9cc4c867\" x=\"54.985\" y=\"128.489143\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_11\">\n",
       "      <!-- 60 -->\n",
       "      <g transform=\"translate(32.945 134.041643)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-36\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_5\">\n",
       "     <g id=\"line2d_11\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m0e9cc4c867\" x=\"54.985\" y=\"80.214857\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_12\">\n",
       "      <!-- 80 -->\n",
       "      <g transform=\"translate(32.945 85.767357)scale(0.16 -0.16)\">\n",
       "       <defs>\n",
       "        <path id=\"LMSans17-Regular-38\" d=\"M 2752 1178 \n",
       "C 2752 1600 2502 2048 1933 2272 \n",
       "C 2419 2432 2669 2816 2669 3194 \n",
       "C 2669 3789 2157 4301 1504 4301 \n",
       "C 826 4301 333 3770 333 3194 \n",
       "C 333 2822 576 2438 1069 2272 \n",
       "C 442 2029 250 1542 250 1178 \n",
       "C 250 474 819 -102 1498 -102 \n",
       "C 2202 -102 2752 486 2752 1178 \n",
       "z\n",
       "M 2214 3187 \n",
       "C 2214 2726 1907 2464 1504 2464 \n",
       "C 1075 2464 787 2752 787 3187 \n",
       "C 787 3629 1075 3910 1504 3910 \n",
       "C 1901 3910 2214 3654 2214 3187 \n",
       "z\n",
       "M 2253 1184 \n",
       "C 2253 518 1830 294 1504 294 \n",
       "C 1139 294 749 544 749 1184 \n",
       "C 749 1843 1184 2074 1498 2074 \n",
       "C 1843 2074 2253 1830 2253 1184 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       </defs>\n",
       "       <use xlink:href=\"#LMSans17-Regular-38\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"ytick_6\">\n",
       "     <g id=\"line2d_12\">\n",
       "      <g>\n",
       "       <use xlink:href=\"#m0e9cc4c867\" x=\"54.985\" y=\"31.940571\" style=\"stroke: #000000; stroke-width: 0.8\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "     <g id=\"text_13\">\n",
       "      <!-- 100 -->\n",
       "      <g transform=\"translate(25.425 37.493071)scale(0.16 -0.16)\">\n",
       "       <use xlink:href=\"#LMSans17-Regular-31\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"46.999985\"/>\n",
       "       <use xlink:href=\"#LMSans17-Regular-30\" x=\"93.999969\"/>\n",
       "      </g>\n",
       "     </g>\n",
       "    </g>\n",
       "    <g id=\"text_14\">\n",
       "     <!-- Count -->\n",
       "     <g transform=\"translate(18.305 159.2885)rotate(-90)scale(0.16 -0.16)\">\n",
       "      <defs>\n",
       "       <path id=\"LMSans17-Regular-43\" d=\"M 3501 301 \n",
       "L 3462 736 \n",
       "C 3290 614 3123 493 2918 429 \n",
       "C 2720 365 2515 358 2310 358 \n",
       "C 1920 358 1568 582 1338 896 \n",
       "C 1050 1274 922 1734 922 2195 \n",
       "C 922 2662 1050 3130 1338 3501 \n",
       "C 1568 3808 1920 4038 2310 4038 \n",
       "C 2496 4038 2675 4019 2848 3962 \n",
       "C 3027 3910 3187 3814 3347 3718 \n",
       "L 3437 4230 \n",
       "C 3258 4301 3072 4358 2880 4397 \n",
       "C 2694 4435 2502 4448 2310 4448 \n",
       "C 1786 4448 1299 4192 954 3789 \n",
       "C 576 3347 390 2778 390 2195 \n",
       "C 390 1619 576 1050 954 608 \n",
       "C 1299 205 1786 -51 2310 -51 \n",
       "C 2522 -51 2733 -45 2938 13 \n",
       "C 3142 77 3322 186 3501 301 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-6f\" d=\"M 2829 1370 \n",
       "C 2829 2189 2221 2829 1504 2829 \n",
       "C 768 2829 173 2170 173 1370 \n",
       "C 173 557 787 -51 1498 -51 \n",
       "C 2227 -51 2829 576 2829 1370 \n",
       "z\n",
       "M 2342 1421 \n",
       "C 2342 698 1926 346 1498 346 \n",
       "C 1050 346 659 723 659 1421 \n",
       "C 659 2163 1114 2432 1498 2432 \n",
       "C 1914 2432 2342 2138 2342 1421 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-75\" d=\"M 2618 0 \n",
       "L 2618 2752 \n",
       "L 2131 2752 \n",
       "L 2131 986 \n",
       "C 2131 512 1786 320 1421 320 \n",
       "C 998 320 960 461 960 723 \n",
       "L 960 2752 \n",
       "L 474 2752 \n",
       "L 474 691 \n",
       "C 474 192 646 -51 1088 -51 \n",
       "C 1306 -51 1798 0 2144 320 \n",
       "L 2144 0 \n",
       "L 2618 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-6e\" d=\"M 2618 0 \n",
       "L 2618 1869 \n",
       "C 2618 2272 2522 2803 1798 2803 \n",
       "C 1389 2803 1120 2592 941 2374 \n",
       "L 941 2771 \n",
       "L 474 2771 \n",
       "L 474 0 \n",
       "L 960 0 \n",
       "L 960 1549 \n",
       "C 960 1952 1114 2413 1549 2413 \n",
       "C 2112 2413 2131 2035 2131 1818 \n",
       "L 2131 0 \n",
       "L 2618 0 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "       <path id=\"LMSans17-Regular-74\" d=\"M 2003 186 \n",
       "L 1901 563 \n",
       "C 1747 429 1562 352 1363 352 \n",
       "C 1082 352 1069 710 1069 870 \n",
       "L 1069 2381 \n",
       "L 1901 2381 \n",
       "L 1901 2752 \n",
       "L 1069 2752 \n",
       "L 1069 3539 \n",
       "L 614 3539 \n",
       "L 614 2752 \n",
       "L 109 2752 \n",
       "L 109 2381 \n",
       "L 602 2381 \n",
       "L 602 762 \n",
       "C 602 397 685 -51 1107 -51 \n",
       "C 1427 -51 1722 38 2003 186 \n",
       "z\n",
       "\" transform=\"scale(0.015625)\"/>\n",
       "      </defs>\n",
       "      <use xlink:href=\"#LMSans17-Regular-43\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-6f\" x=\"60.099991\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-75\" x=\"107.099976\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-6e\" x=\"155.499969\"/>\n",
       "      <use xlink:href=\"#LMSans17-Regular-74\" x=\"203.899963\"/>\n",
       "     </g>\n",
       "    </g>\n",
       "   </g>\n",
       "   <g id=\"patch_24\">\n",
       "    <path d=\"M 54.985 273.312 \n",
       "L 54.985 7.2 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_25\">\n",
       "    <path d=\"M 412.105 273.312 \n",
       "L 412.105 7.2 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_26\">\n",
       "    <path d=\"M 54.985 273.312 \n",
       "L 412.105 273.312 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "   <g id=\"patch_27\">\n",
       "    <path d=\"M 54.985 7.2 \n",
       "L 412.105 7.2 \n",
       "\" style=\"fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square\"/>\n",
       "   </g>\n",
       "  </g>\n",
       " </g>\n",
       " <defs>\n",
       "  <clipPath id=\"p93c9aadc5e\">\n",
       "   <rect x=\"54.985\" y=\"7.2\" width=\"357.12\" height=\"266.112\"/>\n",
       "  </clipPath>\n",
       " </defs>\n",
       "</svg>\n"
      ],
      "text/plain": [
       "<Figure size 640x480 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "sns.histplot(doublets[doublets.prediction == \"doublet\"], x=\"dif\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e9f92eef-460d-4e73-bc8c-06d85b184742",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "### Save/load checkpoint "
   ]
  },
  {
   "cell_type": "markdown",
   "id": "eab27875-0256-4c14-94cf-cc1219e5b008",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "Save current variables to file."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "839377a1-9d80-47a5-ad6f-369aa896fbcf",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "pickle.dump([adata, df, doublets, solo, vae], open(\"session_09282022.p\", \"wb\"))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "79843881-f585-4093-93dc-522a2e39676b",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "Variables can be reloaded if necessary."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "adbe22fb-05ea-4051-a1d7-e18e67c8d061",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-29T00:51:05.400515Z",
     "iopub.status.busy": "2022-09-29T00:51:05.399713Z",
     "iopub.status.idle": "2022-09-29T00:51:07.226134Z",
     "shell.execute_reply": "2022-09-29T00:51:07.225272Z",
     "shell.execute_reply.started": "2022-09-29T00:51:05.400482Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "adata, df, doublets, solo, vae = pickle.load(open(\"session_09282022.p\", \"rb\"))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "17b905a6-0cfa-4137-8139-df573e8edefd",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "### Reload data and filter doublets"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "e94b5d5e-ef19-4e9a-a2b9-b5f9dd8e06a4",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-29T00:52:28.774923Z",
     "iopub.status.busy": "2022-09-29T00:52:28.774121Z",
     "iopub.status.idle": "2022-09-29T00:52:53.279111Z",
     "shell.execute_reply": "2022-09-29T00:52:53.278222Z",
     "shell.execute_reply.started": "2022-09-29T00:52:28.774883Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "AnnData object with n_obs × n_vars = 6099 × 34546"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata = sc.read_csv(\n",
    "    \"data/GSE171524/supplementary/GSM5226574_C51ctr_raw_counts.csv.gz\"\n",
    ").T\n",
    "adata"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f53b0e42-070f-4300-b569-1aed3e635da2",
   "metadata": {},
   "source": [
    "Annotate `adata` with doublet column."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "id": "59e4bfb7-fa41-4fc3-a890-851b7eb999cd",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T21:18:05.357646Z",
     "iopub.status.busy": "2022-09-28T21:18:05.357141Z",
     "iopub.status.idle": "2022-09-28T21:18:05.374756Z",
     "shell.execute_reply": "2022-09-28T21:18:05.373881Z",
     "shell.execute_reply.started": "2022-09-28T21:18:05.357602Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "adata.obs['doublet'] = adata.obs.index.isin(doublets.index)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "id": "3c136530-07c1-451c-bcf0-e40107273dc0",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T21:18:07.951958Z",
     "iopub.status.busy": "2022-09-28T21:18:07.951435Z",
     "iopub.status.idle": "2022-09-28T21:18:07.960209Z",
     "shell.execute_reply": "2022-09-28T21:18:07.958981Z",
     "shell.execute_reply.started": "2022-09-28T21:18:07.951910Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "AnnData object with n_obs × n_vars = 6099 × 34546\n",
       "    obs: 'doublet'"
      ]
     },
     "execution_count": 59,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 60,
   "id": "c7845199-6a12-44d2-8eb5-a7125315c609",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T21:18:22.167443Z",
     "iopub.status.busy": "2022-09-28T21:18:22.166956Z",
     "iopub.status.idle": "2022-09-28T21:18:22.182645Z",
     "shell.execute_reply": "2022-09-28T21:18:22.181342Z",
     "shell.execute_reply.started": "2022-09-28T21:18:22.167401Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>doublet</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>TAGGTACCATGGCCAC-1_1</th>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ATTCACTGTAACAGGC-1_1</th>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TAACTTCCAACCACGC-1_1</th>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTGGGTACACGACAAG-1_1</th>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>AGGCCACAGAGTCACG-1_1</th>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CGCCATTGTTTGCCGG-1_1</th>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CACTGGGGTCTACGTA-1_1</th>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>CATACTTGTAGAGGAA-1_1</th>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>TTTGGTTTCCACGGAC-1_1</th>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>ATGCATGAGTCATGAA-1_1</th>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>6099 rows × 1 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                      doublet\n",
       "TAGGTACCATGGCCAC-1_1     True\n",
       "ATTCACTGTAACAGGC-1_1     True\n",
       "TAACTTCCAACCACGC-1_1    False\n",
       "TTGGGTACACGACAAG-1_1     True\n",
       "AGGCCACAGAGTCACG-1_1     True\n",
       "...                       ...\n",
       "CGCCATTGTTTGCCGG-1_1    False\n",
       "CACTGGGGTCTACGTA-1_1    False\n",
       "CATACTTGTAGAGGAA-1_1    False\n",
       "TTTGGTTTCCACGGAC-1_1    False\n",
       "ATGCATGAGTCATGAA-1_1    False\n",
       "\n",
       "[6099 rows x 1 columns]"
      ]
     },
     "execution_count": 60,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata.obs"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "93a4f629-1031-42a6-99a8-0af816af726f",
   "metadata": {
    "slideshow": {
     "slide_type": "subslide"
    },
    "tags": []
   },
   "source": [
    "Use doublet column to filter doublets."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 61,
   "id": "3150339d-5d8b-45bc-b5c1-9d228c591d9b",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T21:19:38.351183Z",
     "iopub.status.busy": "2022-09-28T21:19:38.349814Z",
     "iopub.status.idle": "2022-09-28T21:19:38.360456Z",
     "shell.execute_reply": "2022-09-28T21:19:38.359041Z",
     "shell.execute_reply.started": "2022-09-28T21:19:38.351123Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "adata = adata[~adata.obs.doublet]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 62,
   "id": "7698bac3-18b7-4c09-9eac-91e07561429a",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-28T21:19:48.132253Z",
     "iopub.status.busy": "2022-09-28T21:19:48.131355Z",
     "iopub.status.idle": "2022-09-28T21:19:48.139975Z",
     "shell.execute_reply": "2022-09-28T21:19:48.138731Z",
     "shell.execute_reply.started": "2022-09-28T21:19:48.132200Z"
    },
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "View of AnnData object with n_obs × n_vars = 5648 × 34546\n",
       "    obs: 'doublet'"
      ]
     },
     "execution_count": 62,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "adata"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f438c86c-c9eb-43d5-a9e1-d6f180377d1c",
   "metadata": {
    "slideshow": {
     "slide_type": "fragment"
    },
    "tags": []
   },
   "source": [
    "We filtered about 7% of the barcodes as putative doublets."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9cbd9488-952d-4e6f-993b-ad16971d4e54",
   "metadata": {},
   "source": [
    "## Preprocessing"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "35615761-f1a6-4d33-a475-b2f954062412",
   "metadata": {},
   "source": [
    "### Filter mitochondrial transcripts"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6706ba59-ef64-4383-8f96-2a704f7fdbc2",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "celltoolbar": "Slideshow",
  "jupytext": {
   "cell_metadata_json": true,
   "formats": "ipynb,md,py:percent",
   "notebook_metadata_filter": "all"
  },
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.7"
  },
  "rise": {
   "scroll": true,
   "theme": "black"
  },
  "toc-autonumbering": true,
  "toc-showcode": false,
  "toc-showmarkdowntxt": false,
  "widgets": {
   "application/vnd.jupyter.widget-state+json": {
    "state": {},
    "version_major": 2,
    "version_minor": 0
   }
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
